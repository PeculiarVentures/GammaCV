/*! For license information please see 9828_d8b55541b919eff90e6c7ba56219dfe468f072ee.js.LICENSE.txt */
(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9828],{9828:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>Tt});var a=n(7294),r=n(5697),i=n.n(r),o=n(2547),l=n(169),c=n.n(l),s=n(4184),u=n.n(s),h=n(3825),f=n(992);function p(){return(p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}var d=(0,f.Z)(),y=(0,f.Z)();function g(t){return a.createElement("svg",p({viewBox:"0 0 83 109"},t),a.createElement("defs",null,a.createElement("linearGradient",{x1:"-10.85%",y1:"84.956%",x2:"102.433%",y2:"9.433%",id:d},a.createElement("stop",{stopColor:"#8F70FA",offset:"0%"}),a.createElement("stop",{stopColor:"#00D093",offset:"100%"})),a.createElement("linearGradient",{x1:".003%",y1:"50%",x2:"100.015%",y2:"50%",id:y},a.createElement("stop",{stopColor:"#8F70FA",offset:"1%"}),a.createElement("stop",{stopColor:"#B26DD7",offset:"28%"}),a.createElement("stop",{stopColor:"#E9699E",offset:"77%"}),a.createElement("stop",{stopColor:"#FF6788",offset:"100%"}))),a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("path",{d:"M48.698 101.326a3.988 3.988 0 0 1 1.146-2.842l5.26-5.27-5.272-5.271a4.01 4.01 0 0 1 0-5.73l6.486-6.485a4.102 4.102 0 0 1 5.729 0L67.317 81l1.433-1.386V13.75C68.75 6.156 62.594 0 55 0H13.75C6.156 0 0 6.156 0 13.75v75.625c0 7.594 6.156 13.75 13.75 13.75h35.395a3.976 3.976 0 0 1-.447-1.799zm-2.865-66.848a5.73 5.73 0 1 1 0 11.458 5.73 5.73 0 0 1 0-11.458zm-28.645 5.73a5.73 5.73 0 1 1 11.458 0 5.73 5.73 0 0 1-11.459 0zm28.645 30.524a2.853 2.853 0 0 1-2.028-.836 13.326 13.326 0 0 0-18.86 0 2.868 2.868 0 0 1-4.056-4.056c7.452-7.44 19.52-7.44 26.972 0a2.865 2.865 0 0 1-2.028 4.892z",fill:"url(#".concat(d,")"),fillRule:"nonzero"}),a.createElement("path",{d:"M82.683 84.31l-6.485-6.485a1.146 1.146 0 0 0-1.616 0l-6.485 6.485a1.146 1.146 0 0 1-1.616 0l-6.485-6.485a1.146 1.146 0 0 0-1.616 0l-6.485 6.485a1.146 1.146 0 0 0 0 1.616l6.485 6.485a1.146 1.146 0 0 1 0 1.616l-6.485 6.486a1.146 1.146 0 0 0 0 1.615l6.485 6.486a1.146 1.146 0 0 0 1.616 0l6.462-6.474a1.146 1.146 0 0 1 1.616 0l6.485 6.485a1.146 1.146 0 0 0 1.616 0l6.485-6.485a1.146 1.146 0 0 0 0-1.616l-6.485-6.485a1.146 1.146 0 0 1 0-1.616l6.508-6.486a1.146 1.146 0 0 0 0-1.627z",fill:"url(#".concat(y,")")})))}var m=n(6275),v=n(2346);function x(){return(x=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}const b=function(t){return a.createElement("svg",x({viewBox:"0 0 512 512"},t),a.createElement("path",{d:"M152.443 136.417L359.557 255.99 152.443 375.583z","data-fill":!0}))};function k(){return(k=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}const S=function(t){return a.createElement("svg",k({viewBox:"0 0 512 512"},t),a.createElement("path",{d:"M162.642 148.337h56.034v215.317h-56.034V148.338zM293.356 148.337h56.002v215.317h-56.002V148.338z","data-fill":!0}))};var _=n(3379),w=n.n(_),E=n(3955);w()(E.Z,{insert:"head",singleton:!1});const T=E.Z.locals||{};function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function P(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function A(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function O(t,e){return(O=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function I(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&O(t,e)}(s,t);var e,n,r,i,l,c=(i=s,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=M(i);if(l){var n=M(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return I(this,t)});function s(){return P(this,s),c.apply(this,arguments)}return e=s,r=[{key:"getCanvasStyles",value:function(t,e,n){var a=t/e;if("mobile"===n)return{width:"100%",height:"100%",top:"0"};if(a>1.3){var r=1.3/a*100;return{width:"100%",height:"".concat(r,"%"),top:"".concat((100-r)/2,"%")}}return{height:"100%",width:"".concat(a/1.3*100,"%"),top:"0"}}}],(n=[{key:"componentDidUpdate",value:function(){"mobile"===this.context.device.type?this.refControl.style.opacity=1:this.refControl.style.opacity=null}},{key:"onMouseEnter",value:function(){this.refNode.style.opacity=.9,this.refControl.style.opacity=1}},{key:"onMouseLeave",value:function(){this.refNode.style.opacity=0,this.refControl.style.opacity=0}},{key:"render",value:function(){var t=this,e=this.context.device,n=this.props,r=n.playing,i=n.onStop,l=n.onPlay,c=n.width,h=n.height,f=n.canvas,p=n.exampleInitialized,d=n.loading;return a.createElement("div",{className:T.wrapper},a.createElement("div",{className:u()(R({},T.padding,"mobile"!==e.type),"fill_light_grey")},a.createElement("div",{onMouseEnter:"mobile"!==e.type?this.onMouseEnter.bind(this):null,onMouseLeave:"mobile"!==e.type?this.onMouseLeave.bind(this):null,ref:function(e){t.refNode=e},className:u()(T.mask,"fill_black"),onClick:r?i:l}),a.createElement("div",{ref:function(e){t.refControl=e},className:T.controls},r&&"mobile"!==e.type&&a.createElement(S,{className:u()(T.icon,"fill_white")}),!r&&a.createElement(b,{className:u()(T.icon,"fill_white")})),!p||d&&a.createElement("div",{className:T.loader},a.createElement(o.D8,{size:40})),a.createElement("canvas",{ref:f,width:c,height:h,className:T.canvas,style:s.getCanvasStyles(c,h,e.type)})))}}])&&A(e.prototype,n),r&&A(e,r),s}(a.Component);function L(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}R(V,"propTypes",{onStop:i().func,onPlay:i().func,playing:i().bool,loading:i().bool,exampleInitialized:i().bool,canvas:i().func,width:i().number,height:i().number}),R(V,"contextTypes",{device:i().object}),R(V,"defaultProps",{canvas:null,width:700,loading:null,onStop:function(){},onPlay:function(){},playing:null,exampleInitialized:null,height:500});const U=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.delay=e,this.callback=n}var e,n;return e=t,(n=[{key:"cancel",value:function(){this.timeout&&clearTimeout(this.timeout)}},{key:"activate",value:function(){for(var t=this,e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];this.cancel(),this.timeout=setTimeout((function(){t.callback&&t.callback.apply(t,n)}),this.delay)}}])&&L(e.prototype,n),t}();function j(){return(j=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}const K=function(t){return a.createElement("svg",j({viewBox:"0 0 19 17"},t),a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("rect",{fill:"#FF610D",width:"18.133",height:"17",rx:"5"}),a.createElement("text",{fontFamily:"OpenSans-Bold, Open Sans",fontSize:"10",fontWeight:"bold",letterSpacing:".214",fill:"#FFF"},a.createElement("tspan",{x:"6.214",y:"12"},"C"))))};function z(){return(z=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}const B=function(t){return a.createElement("svg",z({viewBox:"0 0 19 17"},t),a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("rect",{fill:"#00D093",width:"18.133",height:"17",rx:"5"}),a.createElement("text",{fontFamily:"OpenSans-Bold, Open Sans",fontSize:"10",fontWeight:"bold",letterSpacing:".214",fill:"#FFF"},a.createElement("tspan",{x:"5.333",y:"12"},"U"))))};function F(){return(F=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}const N=function(t){return a.createElement("svg",F({viewBox:"0 0 13 13"},t),a.createElement("defs",null,a.createElement("path",{d:"M12.985 4.107c-.005.063.004.126-.013.188a1.032 1.032 0 0 1-.832.745c-.026.006-.05.014-.077.017l-.007.001c-1.032.104-2.428.153-3.448.164a.904.904 0 0 1-.559-.159.754.754 0 0 1-.145-1.086c.12-.15.284-.25.462-.282.551-.098 1.226-.125 1.873-.152-.315-.146-.653-.277-.853-.426a4.945 4.945 0 0 0-2.94-.957c-2.67 0-4.834 2.08-4.834 4.646s2.165 4.645 4.834 4.645c2.366 0 4.331-1.633 4.75-3.79l1.583.287C12.22 10.823 9.6 13 6.446 13 2.886 13 0 10.227 0 6.806 0 3.386 2.887.612 6.446.612c1.468 0 2.822.471 3.906 1.266.289.212.502.564.7.92-.144-.673-.314-1.392-.36-1.996A.722.722 0 0 1 10.86.3a.828.828 0 0 1 1.13-.14.829.829 0 0 1 .301.48c.247.95.55 2.261.706 3.246v.008c.01.07-.006.141-.012.212",id:"a_reset"})),a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("mask",{id:"b_reset",fill:"#fff"},a.createElement("use",{xlinkHref:"#a_reset"})),a.createElement("use",{"data-fill":!0,xlinkHref:"#a_reset"}),a.createElement("g",{mask:"url(#b_reset)","data-fill":!0},a.createElement("rect",{width:"22",height:"22",rx:"3",transform:"translate(-5 -5)"}))))};var D=n(2249);w()(D.Z,{insert:"head",singleton:!1});const G=D.Z.locals||{};function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function W(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function X(t,e){return(X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Z(t,e){return!e||"object"!==H(e)&&"function"!=typeof e?Y(t):e}function Y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function J(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(c,t);var e,n,r,i,l=(r=c,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=q(r);if(i){var n=q(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return Z(this,t)});function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=l.call(this,t)).state={stateData:e.props.stateData,dafaultParams:!0},e.defaultData=e.props.stateData,e.lazyUpdate=new U(1e3,e.props.onChangeParams.bind(Y(e))),e}return e=c,(n=[{key:"onSetDefault",value:function(){var t=this.props.onChangeParams,e=this.defaultData;this.setState({stateData:e,dafaultParams:!0},(function(){return t(e,"constant")}))}},{key:"onChange",value:function(t,e,n,a,r){var i=this.props.onChangeParams,o=JSON.stringify(this.state.stateData),l=JSON.parse(o);l[t][e]=r,"constant"===n?this.lazyUpdate.activate(l,n,e,r):i(l,n,e,r),this.setState({stateData:l,dafaultParams:!1})}},{key:"renderIcon",value:function(t){return"constant"===t?a.createElement(K,{className:G.icon}):"uniform"===t?a.createElement(B,{className:G.icon}):null}},{key:"renderSelect",value:function(t,e,n,r){var i=this.state.stateData;return a.createElement(o.Ph,{className:G.tabs,onChange:this.onChange.bind(this,n,e,r),value:i[n][e]},t.values.map((function(t,e){return a.createElement(o.Ql,{key:e,value:t.value},t.name)})))}},{key:"renderControls",value:function(t,e,n,r){var i=this.state.stateData;return a.createElement("div",{key:"".concat(n,"_").concat(r),className:G.group_item},this.renderIcon(t.type),a.createElement(o.ZT,{type:"b3",color:"dark_grey",className:G.group_item_name},t.name),t.values&&this.renderSelect(t,e,n,t.type),!t.values&&a.createElement(o.iR,{color:"dark_grey",className:G.slider,step:t.step,min:t.min,max:t.max,value:i[n][e],onChange:this.onChange.bind(this,n,e,t.type),defaultValue:t.default}),a.createElement(o.ZT,{type:"h5",color:"dark_grey",align:"left",className:G.group_item_value},!t.values&&i[n][e]))}},{key:"renderGroup",value:function(t,e){var n=this;return a.createElement("div",{key:e,className:G.group},a.createElement(o.ZT,{type:"c1",color:"grey",className:G.group_name},t.name||e),Object.keys(t).map((function(a,r){return"name"!==a&&n.renderControls(t[a],a,e,r)})))}},{key:"renderResetButton",value:function(){var t=this.state.dafaultParams,e=this.props.data,n=this.context.device;return Object.keys(e).length?a.createElement("div",{className:u()(G.reset,J({},G.m_disabled,t)),onClick:this.onSetDefault.bind(this)},a.createElement(N,{className:u()({fill_dark_grey:"mobile"!==n.type,fill_light_grey:"mobile"===n.type}),style:{width:"13px",display:"inline-block"}}),a.createElement(o.ZT,{style:{display:"inline-block",marginLeft:"5px"},type:"b1",color:"grey"},"Reset")):null}},{key:"renderParams",value:function(){var t=this,e=this.props.data,n=Object.keys(this.props.data);return n.length?a.createElement("div",{className:G.groups},n.map((function(n){return t.renderGroup(e[n],n)}))):null}},{key:"render",value:function(){return a.createElement("div",{className:G.padding},a.createElement("div",{className:G.controls_wrapper},a.createElement("div",{className:G.header},a.createElement(o.ZT,{type:"h4",color:"black",className:G.title},"Params"),this.renderResetButton()),this.renderParams()))}}])&&W(e.prototype,n),c}(a.Component);J(Q,"propTypes",{data:i().oneOfType([i().object]),stateData:i().oneOfType([i().object]),onChangeParams:i().func}),J(Q,"contextTypes",{device:i().object}),J(Q,"defaultProps",{data:{},stateData:{},onChangeParams:function(){}});var $=n(6433);function tt(){return(tt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}function et(t){return a.createElement("svg",tt({viewBox:"0 0 15 12"},t),a.createElement("g",{fill:"none",fillRule:"evenodd"},a.createElement("path",{d:"M1 2h4M9 2h5.333M11.667 10h2.666M1 10h8.333","data-stroke":!0,strokeLinecap:"round"}),a.createElement("path",{d:"M7.667 2a2 2 0 1 1-4 0 2 2 0 0 1 4 0M10.333 10a2 2 0 1 1-4 0 2 2 0 0 1 4 0","data-fill":!0})))}var nt=n(5242);function at(t,e){return t*e}function rt(t,e,n){if(e){var a=function(t,e){return e/t}(t,e);if(a<=n)return{width:e,height:a}}return{width:at(t,n),height:n}}var it="production"===n(7480).NODE_ENV;function ot(t){return(ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var lt=n(5970);w()(lt.Z,{insert:"head",singleton:!1});const ct=lt.Z.locals||{};function st(t){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function ht(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ut(Object(n),!0).forEach((function(e){mt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ut(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ft(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function pt(t,e){return(pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function dt(t,e){return!e||"object"!==st(e)&&"function"!=typeof e?yt(t):e}function yt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gt(t){return(gt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pt(t,e)}(f,t);var e,n,r,i,l,s=(i=f,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gt(i);if(l){var n=gt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return dt(this,t)});function f(t,e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,f),mt(yt(n=s.call(this,t)),"onResizeEnd",(function(){var t=n.context.device;"mobile"===t.type&&(document.getElementById("root").style.overflow="hidden",document.getElementById("root").style.position="relative",n.stop(),n.setState(n.getSize(),(function(){n.imgInput=new v.es("uint8",[n.state.height,n.state.width,4]),n.init(n.props),n.start()}))),"mobile"!==t.type&&(document.getElementById("root").style.overflow="visible",document.getElementById("root").style.position="static",n.stop(),n.setState(ht(ht({},n.getSize()),{},{showParams:!0}),(function(){n.imgInput=new v.es("uint8",[n.state.height,n.state.width,4]),n.init(n.props),n.start()})))})),mt(yt(n),"onResize",(function(){n.lazyUpdate.activate()})),mt(yt(n),"canvasRef",(function(t){n.canvas=t,t&&(n.canvas.width=n.state.width,n.canvas.height=n.state.height)})),n.state=ht({loading:!0,playing:!0,error:"",showParams:!0,exampleInitialized:!1},n.getSize(e)),n.lazyUpdate=new U(500,n.onResizeEnd);var a=f.generateParams(t.example),r=a.params,i=a.components;n.params=r,n.components=i,n.imgInput=new v.es("uint8",[n.state.height,n.state.width,4]),n.init(t),n.frameNumber=0,n.loading=!1;var o=c()((function(t){n.refFps.innerHTML=t.fps.toFixed(0)}),3),l="function"==typeof t.example.tick?t.example.tick:n.tick;return n.tick=function(){o(),n.state.exampleInitialized||n.setState({exampleInitialized:!0}),n.stream.getImageBuffer(n.imgInput),n.loading&&!n.checkRerender(n.imgInput.data)?(n.setState({loading:!1}),n.loading=!1):n.loading||(l.apply(yt(n),[n.frameNumber,{canvas:n.canvas,params:n.params,operation:n.op,session:n.sess,input:n.imgInput,output:n.imgOutput,context:n.opContext}]),n.frameNumber+=1),n.timeout=window.requestAnimationFrame(n.tick)},n.mounted=!0,n}return e=f,r=[{key:"generateParams",value:function(t){var e={},n=[];if("object"===st(t.params))for(var a in t.params){var r={name:a,items:[]};if(e[a]={},"object"===st(t.params[a]))for(var i in t.params[a]){var o=t.params[a][i];e[a][i]=void 0!==o.default?o.default:o.min||(o.values?o.values[0].value:0),r.items.push(o)}n.push(r)}return{params:e,components:n}}}],(n=[{key:"componentWillMount",value:function(){"mobile"===this.context.device.type&&(this.setState({showParams:!1}),document.getElementById("root").style.overflow="hidden",document.getElementById("root").style.position="relative")}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize),this.state.error||this.start()}},{key:"componentWillUnmount",value:function(){this.mounted=!1,window.removeEventListener("resize",this.onResize),this.stop(),document.getElementById("root").style.overflow="visible",document.getElementById("root").style.position="static"}},{key:"onChangeParamsShow",value:function(){var t=this.state.showParams;this.setState({showParams:!t})}},{key:"onChangeParams",value:function(t,e,n,a){if(this.params=JSON.parse(JSON.stringify(t)),"constant"===e)this.stop(),this.init(this.props),this.start();else for(var r in this.sess.operation)for(var i in this.sess.operation[r].uniform)i===n&&this.sess.operation[r].uniform[n].set(a)}},{key:"getSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.context;if("mobile"===t.device.type){var e=document.getElementById("root"),n=rt(e.offsetWidth/(e.offsetHeight-60),Math.min(e.offsetWidth,600),Math.min(e.offsetHeight,600));return{width:~~n.width,height:~~n.height}}return{width:500,height:384}}},{key:"start",value:function(){var t=this;this.stream.start().catch((function(){t.stop(!0),t.setState({error:"PermisionDenied"})})),this.timeout=window.requestAnimationFrame(this.tick),this.setState({playing:!0}),!this.loading&&this.checkRerender(this.stream.getImageBuffer("uint8"))&&(this.setState({loading:!0}),this.loading=!0)}},{key:"stop",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.stream.stop(),t&&this.sess.destroy(),window.cancelAnimationFrame(this.timeout),this.setState({playing:!1})}},{key:"checkRerender",value:function(t){for(var e=!0,n=0;n<t.length;n+=16)0!==t[n]&&(e=!1);return e}},{key:"init",value:function(t){var e=this.state,n=e.width,a=e.height;!function(t,e){var n=t.tick,a=t.init,r=t.op,i=t.params;if(n&&"function"!=typeof n)throw new Error("Error in ".concat(e," example: tick must be a function"));if(a&&"function"!=typeof a)throw new Error("Error in ".concat(e," example: init must be a function"));if(r&&"function"!=typeof r)throw new Error("Error in ".concat(e," example: op must be a function"));if(i&&("object"!==ot(i)||Array.isArray(i)))throw new Error("Error in ".concat(e," example: params must be an object"))}(t.example,t.exampleName);try{if(this.sess=new v.z_,this.stream=new v.U8(n,a),t.example.init&&(this.opContext=t.example.init(this.op,this.sess,this.params)),this.op=t.example.op(this.imgInput,this.params,this.opContext),!(this.op instanceof v.OX))throw new Error("Error in ".concat(t.exampleName," example: function <op> must return Operation"),null,null);this.imgOutput=v.He(this.op),this.sess.init(this.op)}catch(t){this.mounted?this.setState({error:"NotSupported"}):this.state.error="NotSupported",function(t,e){t&&(it&&window.rollbar?new Promise((function(e){return window.rollbar.error(t,undefined,e)})):console.error(t))}(t)}}},{key:"tick",value:function(t){this.sess.runOp(this.op,t,this.imgOutput),v.t4(this.canvas,this.imgOutput)}},{key:"renderCloseBlock",value:function(){var t=this.state.showParams;return a.createElement("div",{onClick:this.onChangeParamsShow.bind(this),className:ct.close_block},t&&a.createElement($.Z,{className:u()(ct.icon,ct.cross,"fill_light_grey")}),!t&&a.createElement(et,{className:u()(ct.icon,ct.cross,"fill_light_grey","stroke_light_grey")}),a.createElement(o.ZT,{className:ct.sett_text,type:"b1",color:"light_grey"},t?"Close":"Params"))}},{key:"renderErrorButton",value:function(){var t=this.state.error,e=this.context.intl;return"NotSupported"===t?a.createElement(h.Z,{to:"".concat(m.Z,"/examples"),href:"".concat(m.Z,"/examples")},a.createElement(o.zx,{size:"large",color:"primary",className:ct.button},e.getText("Example.Errors.Button.".concat(t)))):a.createElement(o.zx,{href:window.location.href,size:"large",color:"primary",className:ct.button},e.getText("Example.Errors.Button.".concat(t)))}},{key:"render",value:function(){var t=this,e=this.props,n=e.example,r=e.exampleName,i=this.context,l=i.device,c=i.intl,s=this.state,h=s.playing,f=s.exampleInitialized,p=s.loading,d=s.showParams,y=s.error,m=Object.keys(this.params).length>0;return y?a.createElement("div",{className:ct.example_wrapper},a.createElement("div",{className:ct.error_container},a.createElement(g,{className:ct.error_icon}),a.createElement(o.ZT,{type:"h3",mobileType:"h4",color:"black",align:"center",className:ct.error_descr},c.getText("Example.Errors.".concat(y))),this.renderErrorButton())):a.createElement("div",{className:ct.example_wrapper},a.createElement("div",{className:ct.container},a.createElement(o.ZT,{type:"h3",color:"black",mobileType:"h4",className:u()(ct.title,mt({},ct.none,"mobile"===l.type&&d))},a.createElement("span",{className:ct.title_text},function(t){for(var e=0;e<nt.length;e+=1)for(var n=0;n<nt[e].examples.length;n+=1)if(nt[e].examples[n].path===t)return nt[e].examples[n].name;return"Undefined"}(r)),a.createElement("span",{className:u()(ct.fps,"text_grey"),style:{opacity:!p&&h?1:0}},"FPS: ",a.createElement("span",{ref:function(e){t.refFps=e}},"Inf."))),m&&"mobile"===l.type&&this.renderCloseBlock(),a.createElement("div",{className:ct.part,style:{width:m&&"mobile"!==l.type||!m&&"mobile"!==l.type?"58.3333%":"100%"}},a.createElement(V,{exampleInitialized:f,playing:h,loading:p,onPlay:this.start.bind(this),onStop:this.stop.bind(this,!1),canvas:this.canvasRef,width:this.state.width,height:this.state.height})),m&&d&&a.createElement("div",{className:ct.part,style:{width:m&&"mobile"!==l.type?"calc(41.666% - 20px)":null}},"mobile"===l.type&&d&&a.createElement("div",{className:u()("fill_black",ct.mask)}),a.createElement(Q,{onChangeParams:this.onChangeParams.bind(this),stateData:this.params,data:n.params}))))}}])&&ft(e.prototype,n),r&&ft(e,r),f}(a.Component);mt(vt,"propTypes",{example:i().shape({op:i().func,params:i().object,tick:i().func,init:i().func}),exampleName:i().string}),mt(vt,"contextTypes",{device:i().object,intl:i().object}),mt(vt,"defaultProps",{example:{},exampleName:""});var xt=n(4805);function bt(t){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function kt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function St(t,e){return(St=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _t(t,e){return!e||"object"!==bt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function wt(t){return(wt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Tt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&St(t,e)}(s,t);var e,r,i,l,c=(i=s,l=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=wt(i);if(l){var n=wt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return _t(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=c.call(this)).state={example:!1,notFound:!1,error:null},e.pr=n(8251)("./".concat(t.match.params.id,".js")).then((function(t){return e.setState({example:t.default})})).catch((function(t){return e.setState({notFound:!0}),(0,xt.Z)(t)})),e}return e=s,(r=[{key:"componentDidCatch",value:function(t){this.setState({error:t})}},{key:"render",value:function(){var t=this.state,e=t.error,n=t.example,r=t.notFound;return e?a.createElement("div",{className:ct.example_wrapper},a.createElement("div",{style:{display:"inline-block"}},a.createElement(o.ZT,{type:"b2",color:"black",align:"center"},e.message))):n?a.createElement(vt,{example:n,exampleName:this.props.match.params.id}):r?a.createElement("div",{className:ct.example_wrapper},a.createElement("div",{style:{display:"inline-block"}},a.createElement(o.ZT,{type:"h1",color:"black",align:"center",style:{marginBottom:"15px"}},"404"),a.createElement(o.ZT,{type:"h3",color:"black",align:"center"},"Page not found"))):null}}])&&kt(e.prototype,r),s}(a.Component);Et(Tt,"propTypes",{match:i().shape({params:i().object})}),Et(Tt,"defaultProps",{match:{params:{}}})},2346:(t,e,n)=>{"use strict";n.d(e,{U8:()=>wt,he:()=>Ae,x1:()=>ln,NT:()=>dt,OX:()=>W,z_:()=>q,es:()=>ct,Eg:()=>an,IH:()=>ze,sc:()=>De,mU:()=>qt,dH:()=>mt,qX:()=>xt,t4:()=>gt,pj:()=>Xt,UN:()=>vt,Ig:()=>Qt,Te:()=>Lt,lE:()=>Le,hi:()=>Be,Bf:()=>Ge,DU:()=>Bt,Gq:()=>Re,my:()=>jt,se:()=>Et,KX:()=>ue,qs:()=>ke,T4:()=>Ht,lw:()=>Ut,DV:()=>le,j_:()=>We,BV:()=>Fe,Mm:()=>He,KO:()=>ve,Lb:()=>Te,SI:()=>zt,gm:()=>tn,z$:()=>ye,My:()=>Ft,sh:()=>en,lu:()=>Ke,ZT:()=>Ne,OS:()=>tt,He:()=>$,Lj:()=>Ie,AP:()=>Xe});var a={};n.r(a),n.d(a,{float:()=>j,main:()=>V,pickValue:()=>U});var r={};function i(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}n.r(r),n.d(r,{boxBlur:()=>Pt,edgeDetection:()=>It,edgeDetection2:()=>Mt,edgeDetection3:()=>Rt,gaussianBlur:()=>Ct,invert:()=>Ot,sharpen:()=>At,unsharpMasking:()=>Vt});var o=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=t.GlobalCountIncrease(),this.name="".concat(e,":").concat(this.id)}var e,n;return e=t,n=[{key:"GlobalCountIncrease",value:function(){return t.GlobalNodesCount+=1,t.GlobalNodesCount}}],null&&i(e.prototype,null),n&&i(e,n),t}();function l(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}o.GlobalNodesCount=0;var c=function(){function t(e,n,a,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.gl=e,this.name=a,this.dtype=r,this.location=e.getUniformLocation(n,this.name)}var e,n;return e=t,(n=[{key:"set",value:function(t){var e=this.gl;switch(this.dtype){case"int":e.uniform1i(this.location,t);break;case"float":e.uniform1f(this.location,t);break;case"vec2":e.uniform2fv(this.location,t);break;case"vec3":e.uniform3fv(this.location,t);break;case"vec4":e.uniform4fv(this.location,t);break;case"mat3":e.uniformMatrix3fv(this.location,!1,t);break;case"mat4":e.uniformMatrix4fv(this.location,!1,t);break;default:return!1}return!0}}])&&l(e.prototype,n),t}();function s(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var u=function(){function t(e,n,a,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.program=n,this.gl=e,this.name=a,this.dtype=r,this.location=e.getAttribLocation(this.program,this.name),this.ctx=e.createBuffer(),this.empty=new ArrayBuffer(1),"float"===r||"int"===r?this.size=1:(this.size=parseInt(/\d/g.exec(r)[0],10),e.enableVertexAttribArray(this.location))}var e,n;return e=t,(n=[{key:"set",value:function(t){var e=this.gl;this.bind(this.ctx),"int"===this.dtype?e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),e.STATIC_DRAW):e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW)}},{key:"bind",value:function(){var t=this.gl;"int"===this.dtype?t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ctx):(t.bindBuffer(t.ARRAY_BUFFER,this.ctx),t.vertexAttribPointer(this.location,this.size,t.FLOAT,!1,0,0))}},{key:"unbind",value:function(){var t=this.gl;"int"===this.dtype?t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null):(t.bindBuffer(t.ARRAY_BUFFER,null),t.vertexAttribPointer(this.location,this.size,t.FLOAT,!1,0,0))}},{key:"disable",value:function(){this.gl.disableVertexAttribArray(this.ctx)}},{key:"enable",value:function(){this.gl.enableVertexAttribArray(this.ctx)}},{key:"delete",value:function(){this.gl.deleteBuffer(this.ctx),this.program=null,this.gl=null,this.ctx=null}}])&&s(e.prototype,n),t}();function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}var f="Error: An error occurred compiling the shaders: ";function p(t){var e=/\d+\|(\s+)/.exec(t);return" ".repeat(e?e[1].length:2)}function d(t){var e=t.split("\n"),n=(e.length+1).toString().length;return e.map((function(t,e){return"".concat((e+1).toString().padStart(n),"|  ").concat(t)}))}function y(t){for(var e=0,n=0,a=0;a<t.length;a+=1)/ERROR/.exec(t[a])&&(e+=1),/WARNING/.exec(t[a])&&(n+=1);return{errCount:e,warnCount:n}}function g(t,e,n){try{var a,r=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=d(t),r=(a.length+1).toString().length,i=e.toString(),o=[],l=[];i.startsWith(f)&&(i=i.substr(f.length));for(var c=i.split("\n"),s=y(c),u=0,h=0;h<c.length;h+=1){var g=c[h],m=/0:(\d+)/.exec(g);if(m){var v=+m[1]+u,x="".concat(" ".repeat(r),"|").concat(p(a[v-1]));o.push("".concat(g,"\n").concat(a[v-2],"\n").concat(a[v-1],"\n").concat(x,"^\n").concat(a[v]));var b=n?"%c":"";a.splice(v,0,"".concat(b).concat(x,"^--").concat(g).concat(b)),n&&(l.push("color: red;"),l.push("color: inherit;")),u+=1}}return{fullText:a.join("\n"),firstError:o[0],errorsStats:s,fullTextStyle:l}}(t,n),i=r.errorsStats;console.group("Error: An error occurred compiling the shader ".concat(e,": ").concat(i.errCount," ERRORS, ").concat(i.warnCount," WARNINGS")),console.log(r.firstError),console.groupCollapsed("Show more"),(a=console).log.apply(a,[r.fullText].concat(function(t){if(Array.isArray(t))return h(t)}(o=r.fullTextStyle)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(o)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())),console.groupEnd(),console.groupEnd()}catch(t){console.warn("Unable to process GLSG compiling error.")}var o}var m=["pickCurrentValue","pickValue","float"],v=function(t,e){if(!t)throw new Error(e)},x=function(t){!function(t,e){v(t,'GammaCV: DOMFeature not supported, "'.concat(e,'" is not supported in current environment'))}(document&&document.createElement,t)},b=function(t){return Array.isArray(t)&&t.length>0&&!t.some((function(t){return t%1!=0}))},k=function(t){return t instanceof W},S=function(t){return t instanceof dt},_=function(t){return t instanceof ct},w=function(t){return"function"==typeof HTMLVideoElement&&t instanceof HTMLVideoElement},E=function(t){return"function"==typeof HTMLCanvasElement?t instanceof HTMLCanvasElement:"getContext"in t},T=function(t){return m.includes(t)},C=function(t){return/^[A-Za-z](\w+)?$/.test(t)},P=function(t){return t[0]>0&&t[1]>0};function A(t,e){console.warn('GammaCV Deprecation Warning: "'.concat(t,'" is deprecated').concat(e?", ".concat(e):"",'. "').concat(t,'" will be removed in next major version.'))}function O(){try{return x("canvas"),document.createElement("canvas")}catch(t){return v("function"==typeof OffscreenCanvas,"OffscreenCanvas"),new OffscreenCanvas(1,1)}}Error;var I={},M={SUPPORTS_FLOAT_TEXTURES:function(){var t=O().getContext("webgl");if(!t)return!1;if(!t.getExtension("OES_texture_float"))return!1;var e=t.createFramebuffer(),n=t.createTexture();I.MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.FLOAT,null),t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var a,r=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;try{t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,new Float32Array(4)),a=t.getError()===t.NO_ERROR}catch(t){a=!1}return r&&a}(),DEBUG:!1,MAX_TEXTURE_SIZE:I.MAX_TEXTURE_SIZE};const R=Object.assign({},M);function V(t){var e="\nvoid main(void) {\n  vec2 coords = gl_FragCoord.xy - 0.5;\n  vec4 result = operation(coords.y, coords.x);\n\n  gl_FragColor = result;\n}\n  ";return R.SUPPORTS_FLOAT_TEXTURES||"float32"!==t.dtype||(e="\n    void main(void) {\n      vec2 coords = gl_FragCoord.xy;\n\n      highp float ox = floor(coords.x / 4.0);\n      float dx = floor(coords.x - ox * 4.0 + 0.5);\n    \n      vec4 result = operation(coords.y - 0.5, floor((coords.x - 0.5) / 4.0));\n\n      float value;\n\n      if (dx == 1.0) {\n        value = result.r;\n      } else if (dx == 2.0) {\n        value = result.g;\n      } else if (dx == 3.0) {\n        value = result.b;\n      } else if (dx == 4.0) {\n        value = result.a;\n      }\n    \n      gl_FragColor = encode_float(value);\n    }\n    "),e}function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,a=new Array(e);n<e;n++)a[n]=t[n];return a}function U(t){for(var e=Object.keys(t.input),n=[],a=function(a){var r=e[a];if(!t.input[r].shape)return"continue";var i,o=function(t){if(Array.isArray(t))return L(t)}(i=t.input[r].shape)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(i)||function(t,e){if(t){if("string"==typeof t)return L(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(t,e):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),l=o[1].toFixed(1),c=o[0].toFixed(1),s=(4*o[1]).toFixed(1),u=function(t,e,n){return"".concat(t," ").concat(e,"_").concat(r,"(float y, float x) {\n\treturn texture2D(").concat(r,", vec2((x + 0.5) / ").concat(l,", (y + 0.5) / ").concat(c,"))").concat(n,";\n}")};R.SUPPORTS_FLOAT_TEXTURES||"float32"!==t.input[r].dtype||(u=function(t,e,n){return"\n        ".concat(t," ").concat(e,"_").concat(r,"(float y, float x) {\n          float r = decode_float(texture2D(").concat(r,", vec2((x * 4.0 + 0.5) / ").concat(s,", y / ").concat(c,")));\n          float g = decode_float(texture2D(").concat(r,", vec2((x * 4.0 + 1.5) / ").concat(s,", y / ").concat(c,")));\n          float b = decode_float(texture2D(").concat(r,", vec2((x * 4.0 + 2.5) / ").concat(s,", y / ").concat(c,")));\n          float a = decode_float(texture2D(").concat(r,", vec2((x * 4.0 + 3.5) / ").concat(s,", y / ").concat(c,")));\n\n          return vec4(r, g, b, a)").concat(n,";\n        }\n      ")}),n.push(u("vec4","pickValue","")),n.push(u("float","pickScalarValue",".x"))},r=0;r<e.length;r+=1)a(r);return n.join("\n")}var j=function(){return"/**\n * @author twerdster from https://stackoverflow.com/a/7237286\n */\nprecision highp float;\n\nhighp vec4 encode_float(highp float f) {\n  if (f == 1. / 0.) {\n    return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n  }\n\n  highp vec4 rgba;\n  highp float e =5.0;\n  highp float F = abs(f); \n  highp float sign = step(0.0,-f);\n  highp float exponent = floor(log2(F));\n  highp float mantissa = (exp2(- exponent) * F);\n  exponent = floor(log2(F) + 127.0) + floor(log2(mantissa));\n  rgba[0] = 128.0 * sign + floor(exponent * exp2(-1.0));\n  rgba[1] = 128.0 * mod(exponent, 2.0) + mod(floor(mantissa * 64.0 * 2.0), 128.0);  \n  rgba[2] = floor(mod(floor(mantissa * exp2(23.0 -8.0)), exp2(8.0)));\n  rgba[3] = floor(exp2(23.0) * mod(mantissa, exp2(-15.0)));\n\n  return rgba.abgr / 255.0;\n}\n\nfloat decode_float(highp vec4 rgba) {\n  rgba = rgba.abgr * 255.0;\n  highp float sign = 1.0 - step(128.0,rgba[0])*2.0;\n  highp float exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0; \n  exponent = floor(exponent + 0.5);\n  highp float mantissa = mod(rgba[1],128.0)*32768.0 * 2.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);\n  highp float result = sign\n    * mantissa\n    * exp2(-23.0)\n    * exp2(exponent);\n\n  return result;\n}\n"};function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function z(t){return["bool","int","uint","float","double","vec2","vec3","vec4","mat2","mat3","mat4","sampler2D"].indexOf(t)>=0}function B(t){var e=K(t);t=String(t);var n=/^(vec\d|mat\d)\([^)]+\)$/.exec(t);return n?e=n[1]:/^\d+$/.exec(t)?e="int":/^\d+\.(\d+)?$/.exec(t)?e="float":"boolean"===e&&(e="bool"),e}function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function G(t,e){return!e||"object"!==F(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&D(t,e)}(l,t);var e,n,r,i,o=(r=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=H(r);if(i){var n=H(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return G(this,t)});function l(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,l),v(void 0!==t,"Operation: Operation should have a name"),(e=o.call(this,t)).dtype=null,e.input={},e.uniform={},e.constant={},e.chunks=[],e.inputKeys=[],e.isInitialized=!1,e.lastCtx=Math.random(),e.cache=!0,e}return e=l,(n=[{key:"run",value:function(t,e,n){v(this.isInitialized,"Operation: Unable to run uninitialized operation.");var a=this.gl,r=t.texture[this.name];if(e===this.lastCtx&&this.cache&&!n)return r.bind(this.program,!1,this.inputKeys.length),this.bindBuffer(),!1;this.lastCtx=e,a.useProgram(this.program);for(var i=0;i<this.inputKeys.length;i+=1){var o=this.inputKeys[i],l=this.input[o],c=l.name,s=t.texture[c];s.bind(this.program,o,i),_(l)&&s.set(l),S(l)&&s.set(l.media)}return r.bind(this.program,!1,this.inputKeys.length),this.bindBuffer(),R.SUPPORTS_FLOAT_TEXTURES?a.viewport(0,0,this.shape[1],this.shape[0]):a.viewport(0,0,("float32"===this.dtype?4:1)*this.shape[1],this.shape[0]),a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0),!0}},{key:"unbindBuffer",value:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)}},{key:"bindBuffer",value:function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer)}},{key:"init",value:function(t){if(!this.isInitialized){if(this.gl=t,this.program=t.createProgram(),this.framebuffer=t.createFramebuffer(),this.isInitialized)return!1;this.constant.OUT_VIEW="vec2(".concat(this.shape[1],", ").concat(this.shape[0],")"),this.kernel=function(t){var e,n;if(n=t.kernel,/void main\(([^)]+)?\)([\s]+)?{/.exec(n))e=t.kernel;else{var r=function(t){for(var e=Object.assign({},t.uniform),n=Object.keys(t.input),a="precision highp float;\n",r=0;r<n.length;r+=1)e[n[r]]={dtype:"sampler2D"};for(var i=Object.keys(e),o=0;o<i.length;o+=1){var l=i[o];if(!z(e[l].dtype))throw new Error("KernelConstructor: Uniform ".concat(l,' has invalid type "').concat(e[l].dtype,'"'));a+="uniform ".concat(e[l].dtype," ").concat(l,";\n")}a+="varying vec2 texCoords;\n";for(var c=Object.keys(t.constant),s=0;s<c.length;s+=1){var u=c[s],h=t.constant[u];"number"===K(h)&&h%1==0&&(h=h.toFixed(1));var f=B(h);if(!z(f))throw new Error("KernelConstructor: Constant ".concat(u,', has invalid type "').concat(f,'"'));a+="#define ".concat(u," ").concat(h,"\n")}return a}(t),i=function(t){var e=[];return R.SUPPORTS_FLOAT_TEXTURES||e.push("float"),e.concat(t.chunks.filter((function(t,e,n){return n.indexOf(t)===e}))).map((function(e){var n=" Chunk ".concat(e," "),r=35-n.length,i="".concat("-".repeat(Math.floor(r/2))).concat(n).concat("-".repeat(Math.ceil(r/2)));if("function"==typeof a[e])return"/*".concat(i,"*/\n").concat(a[e](t),"\n/*").concat("-".repeat(35),"*/");throw new TypeError('KernelConstructor: Chunk "'.concat(e,'" is not a function'))})).join("\n")}(t),o=V(t);e=[r,i,t.kernel,o].join("\n\n")}return R.DEBUG&&(console.groupCollapsed(t.name),console.log(d(e).join("\n")),console.groupEnd()),e}(this);try{this.vertexShader=this.getShader("vertex","/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nprecision highp float;\n\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoords;\nvarying vec2 texCoords;\n\nvoid main(void) {\n  texCoords = aTextureCoords;\n\n  gl_Position = vec4(aVertexPosition, 1.0);\n}"),t.attachShader(this.program,this.vertexShader),this.fragmentShader=this.getShader("fragment",this.kernel),t.attachShader(this.program,this.fragmentShader),t.linkProgram(this.program),t.useProgram(this.program)}catch(t){throw g(this.kernel,this.name,t),new Error("Operation: Error during shader compilation.\n".concat(t.message))}this.attributes={aVertexPosition:new u(this.gl,this.program,"aVertexPosition","vec3"),aTextureCoords:new u(this.gl,this.program,"aTextureCoords","vec2"),aIndices:new u(this.gl,this.program,"aIndices","int")},this.attributes.aVertexPosition.set([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),this.attributes.aTextureCoords.set([1,1,0,1,0,0,1,0]),this.attributes.aIndices.set([0,1,2,0,2,3]);for(var e=Object.keys(this.uniform),n=0;n<e.length;n+=1){var r=this.uniform[e[n]];this.uniform[e[n]]=new c(this.gl,this.program,r.name,r.dtype),r.defaultValue&&this.uniform[e[n]].set(r.defaultValue)}this.isInitialized=!0}return!0}},{key:"getShader",value:function(t,e){var n,a=this.gl;if(n="fragment"===t?a.createShader(a.FRAGMENT_SHADER):a.createShader(a.VERTEX_SHADER),a.shaderSource(n,e),a.compileShader(n),!a.getShaderParameter(n,a.COMPILE_STATUS))throw new Error("Operation: An error occurred compiling the shaders.\n".concat(a.getShaderInfoLog(n)));return n}},{key:"traverse",value:function(t,e){for(var n=Object.keys(this.input),a=0;a<n.length;a+=1){var r=n[a];k(this.input[r])?this.input[r].traverse(t,e):t(this.input[r],e)}t(this,e)}},{key:"getDependencies",value:function(){for(var t=[],e=Object.keys(this.input),n=0;n<e.length;n+=1){var a=e[n];if(k(this.input[a])){for(var r=this.input[a].getDependencies(),i=0;i<r.length;i+=1)-1===t.indexOf(r[i])&&t.push(r[i]);t.concat(r)}}return t.push(this.name),t}},{key:"assignInput",value:function(t,e){this.input[t]=e,-1===this.inputKeys.indexOf(t)&&this.inputKeys.push(t)}},{key:"cloneProp",value:function(t){for(var e=Object.keys(this[t]),n={},a=0;a<e.length;a+=1){var r=e[a];n[r]=this[t][r]}return n}},{key:"destroy",value:function(){this.program&&this.gl.deleteProgram(this.program),this.vertexShader&&this.gl.deleteShader(this.vertexShader),this.fragmentShader&&this.gl.deleteShader(this.fragmentShader),this.framebuffer&&this.gl.deleteFramebuffer(this.framebuffer)}},{key:"clone",value:function(){var t=new l(this.name.split(":")[0]);return t.input=this.cloneProp("input"),t.uniform=this.cloneProp("uniform"),t.constant=this.cloneProp("constant"),t.dtype=this.dtype,t.kernel=this.kernel,t.chunks=this.chunks,t}}])&&N(e.prototype,n),l}(o);function X(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var Z=function(){function t(e,n,a,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"float32"!==e&&"uint8"!==e)throw new Error("GPUTexture: Invalid texture type, currently supported is: float32, uint8, but got ".concat(e," "));this.unit=a,this.dtype=e,this.gl=n,this.ctx=n.createTexture(),this.shape=r,n.bindTexture(n.TEXTURE_2D,this.ctx),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.allocate()}var e,n;return e=t,(n=[{key:"allocate",value:function(){var t=this.gl,e=this.shape[1],n=t.UNSIGNED_BYTE;"float32"===this.dtype&&(R.SUPPORTS_FLOAT_TEXTURES?n=t.FLOAT:e*=4),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,this.shape[0],0,t.RGBA,n,null)}},{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.gl;if(w(t)||E(t))e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);else{var n=t.shape[1],a=e.UNSIGNED_BYTE,r=t.data;"float32"===t.dtype&&(R.SUPPORTS_FLOAT_TEXTURES?a=e.FLOAT:(n*=4,r=t.uint8View)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n,this.shape[0],0,e.RGBA,a,r)}}},{key:"bind",value:function(t,e,n){var a=this.gl;if(e){var r=a.getUniformLocation(t,e);a.uniform1i(r,n)}a.activeTexture(a.TEXTURE0+n),a.bindTexture(a.TEXTURE_2D,this.ctx),this.unit=n}},{key:"unbind",value:function(){var t=this.gl;t.activeTexture(t.TEXTURE0+this.unit),t.bindTexture(t.TEXTURE_2D,null)}},{key:"delete",value:function(){var t=this.gl;t.deleteTexture(this.ctx),this.gl=null,this.program=null,this.ctx=null,t.bindTexture(t.TEXTURE_2D,null)}}])&&X(e.prototype,n),t}();function Y(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var q=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=O(),this.canvas.width=1,this.canvas.height=1,this.initWebGL(this.canvas),this.operation={},this.texture={},this.textureCount=0}var e,n;return e=t,(n=[{key:"initWebGL",value:function(t,e){this.canvas=t;var n=this.canvas.getContext("webgl",e);v(!!n,"Session: WebGL not supported.");var a=n.getExtension("OES_texture_float");v(!!a,"Session: Unable to find extension OES_texture_float"),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),this.gl=n}},{key:"init",value:function(t){v(!!t,"Session: Unable to initialize undefined operation"),v(k(t)||_(t),"Session: Unable to initialize operation with invalid input type"),k(t)&&t.traverse((function(t,e){e.operation[t.name]=t}),this),(_(t)||S(t))&&(this.operation[t.name]=t),this.update()}},{key:"update",value:function(){for(var t=this.gl,e=Object.keys(this.operation),n=0;n<e.length;n+=1){var a=this.operation[e[n]];a instanceof W&&a.init(this.gl),this.texture[e[n]]||(this.texture[e[n]]=new Z(a.dtype,this.gl,this.textureCount,a.shape),a instanceof W&&(t.bindFramebuffer(t.FRAMEBUFFER,a.framebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture[e[n]].ctx,0),t.bindFramebuffer(t.FRAMEBUFFER,null)),this.textureCount+=1)}}},{key:"runOp",value:function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=t.sequence,r=!1,i=0;i<a.length;i+=1){var o=a[i],l=this.operation[o],c=i===a.length-1;v(!!l,"Session: Unable to run uninitialized operation ".concat(t.name,".")),E(n)&&c&&(this.canvas.width===l.shape[1]&&this.canvas.height===l.shape[0]||(this.canvas.width=l.shape[1],this.canvas.height=l.shape[0]),l.framebuffer=null),r=!!l.run(this,e,r),n&&c&&_(n)&&this.readToTensor(n),n&&c&&E(n)&&this.readToCanvas(n,l.shape)}}},{key:"destroy",value:function(){var t=this.gl.getExtension("WEBGL_lose_context"),e=Object.keys(this.texture),n=Object.keys(this.operation);t&&t.loseContext();for(var a=0;a<e.length;a+=1)this.texture[e[a]].delete();for(var r=0;r<n.length;r+=1){var i=this.operation[n[r]];i instanceof W&&i.destroy()}this.canvas=null,this.operation={},this.texture={},this.gl=null,this.textureCount=0}},{key:"readToTensor",value:function(t){var e=this.gl,n=t.shape[0],a=t.shape[1],r=e.UNSIGNED_BYTE,i=t.data;"float32"===t.dtype&&(R.SUPPORTS_FLOAT_TEXTURES?r=e.FLOAT:(a*=4,i=t.uint8View)),e.readPixels(0,0,a,n,e.RGBA,r,i)}},{key:"readToCanvas",value:function(t,e){var n=t.getContext("2d");t.width=e[1],t.height=e[0],n.drawImage(this.canvas,0,0,e[1],e[0],0,0,e[1],e[0])}}])&&Y(e.prototype,n),t}();function J(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var Q=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.op=new W(e),this.name=e,this.checkShape=function(t){return t[Object.keys(t)[0]]},this.preCompile=function(){},this.postCompile=function(){},this.chunks=[]}var e,n;return e=t,(n=[{key:"GLSLKernel",value:function(t){return v("string"==typeof t,"RegisterOperation: The kernel should be a string but it is not."),this.op.kernel=t,this}},{key:"LoadChunk",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var a=0,r=e;a<r.length;a++){var i=r[a];v(T(i),"RegisterOperation: There is no available GLSL chunk supported: ".concat(i))}return this.op.chunks=this.op.chunks.concat(e),this}},{key:"Input",value:function(t,e){return v(C(t)),this.op.input[t]={name:t,dtype:e},this}},{key:"Output",value:function(t){return v(null===this.op.dtype,"RegisterOperation: The operation allows a single output."),this.op.dtype=t,this}},{key:"Constant",value:function(t,e){return v(C(t)),this.op.constant[t]=e,this}},{key:"SetShapeFn",value:function(t){return v("function"==typeof t,"RegisterOperation: SetShapeFn should receive function in first argument"),this.checkShape=t,this}},{key:"PreCompile",value:function(t){return v("function"==typeof t,"RegisterOperation: PreCompile should receive function in first argument"),this.preCompile=t,this}},{key:"PostCompile",value:function(t){return v("function"==typeof t,"RegisterOperation: PostCompile should receive function in first argument"),this.postCompile=t,this}},{key:"Uniform",value:function(t,e,n){return v(C(t)),this.op.uniform[t]={name:t,dtype:e,defaultValue:n},this}},{key:"Compile",value:function(t){var e=this.op.clone(),n={},a=Object.keys(t);this.preCompile(e);for(var r=0;r<a.length;r+=1){var i=a[r],o=t[i];v(!!o,"RegisterOperation:".concat(e.name,".").concat(i,":\n         Can't compile operation with undefined input.")),v(_(o)||S(o)||k(o),"RegisterOperation:".concat(e.name,".").concat(i,":\n         Can't compile operation with invalid input type.\n         You can only use Tensor or another Operation to be an input")),n[i]=t[i].shape,e.assignInput(i,t[i])}return e.shape=this.checkShape(n),e.sequence=e.getDependencies(),e}}])&&J(e.prototype,n),t}();function $(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=null;return k(t)&&(n=new ct(e||t.dtype,t.shape)),_(t)&&(n=new ct(e||t.dtype,t.shape)),S(t)&&(n=new ct(e||t.dtype,t.shape)),n}function tt(t,e){if(e.data.set)e.data.set(t.data);else for(var n=0;n<e.size;n+=1)e.data[n]=t.data[n]}function et(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,t.length,4],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32",a=arguments.length>3?arguments[3]:void 0,r=new Array(4*t.length),i=0;i<r.length;i+=1)r[i]=(i+1)%4==0&&"number"==typeof a?a:t[~~(i/4)];return new ct(n,e,ct.GetTypedArray(n,r))}function nt(t){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function at(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function it(t,e){return(it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ot(t,e){return!e||"object"!==nt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function lt(t){return(lt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&it(t,e)}(l,t);var e,n,a,r,i,o=(r=l,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lt(r);if(i){var n=lt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return ot(this,t)});function l(t,e,n,a){var r,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return at(this,l),(r=o.call(this,"Tensor")).dtype=t,r.shape=e||[n.length],v(b(r.shape),"Tensor: Shape is not valid"),a&&(v(b(a),"Tensor: Stride is not valid"),v(r.shape.length===a.length,"Tensor: Stride length should be equal to shape length")),v("number"==typeof i&&i%1==0,"Tensor: Offset should be integer, but got ".concat(i)),r.size=l.GetSize(r.shape),r.stride=a||r._defineStride(r.shape),r.offset=i,r._compileJITMethods(),void 0===n?(r.data=l.Malloc(t,r.size),r.empty=l.Malloc(t,r.size)):r.assign(n),R.SUPPORTS_FLOAT_TEXTURES||"float32"!==t||(r.uint8View=new Uint8Array(r.data.buffer)),r}return e=l,a=[{key:"IndexToCoord",value:function(t,e){for(var n=new Array(t.length),a=e,r=t.reduce((function(t,e){return t*e})),i=0;i<=t.length-2;i+=1){var o=~~(a/(r/=t[i]));a%=r,n[i]=o}return n[n.length-1]=a%t[t.length-1],n}},{key:"CoordToIndex",value:function(t,e){for(var n=1,a=0,r=t.length-1;r>=0;r-=1)a+=n*e[r],n*=t[r];return a}},{key:"Malloc",value:function(t,e){switch(t){case"uint8":return new Uint8Array(e);case"uint16":return new Uint16Array(e);case"uint32":return new Uint32Array(e);case"int8":return new Int8Array(e);case"int16":return new Int16Array(e);case"int32":return new Int32Array(e);case"float32":return new Float32Array(e);case"float64":return new Float64Array(e);case"uint8c":return new Uint8ClampedArray(e);case"array":return new Array(e);default:throw new Error("Tensor: Unexpected type: ".concat(t,"."))}}},{key:"DefineType",value:function(t){var e=Object.prototype.toString.call(t);switch(e){case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Float32Array]":return"float32";case"[object Float64Array]":return"float64";case"[object Uint8ClampedArray]":return"uint8c";case"[object Array]":return"array";default:throw new Error("Tensor: Unknown dtype: ".concat(e,"."))}}},{key:"GetTypedArray",value:function(t,e){if(t===l.DefineType(e))return e;switch(t){case"uint8":return new Uint8Array(e);case"uint16":return new Uint16Array(e);case"uint32":return new Uint32Array(e);case"int8":return new Int8Array(e);case"int16":return new Int16Array(e);case"int32":return new Int32Array(e);case"float32":return new Float32Array(e);case"float64":return new Float64Array(e);case"uint8c":return new Uint8ClampedArray(e);case"array":return new Array(e);default:throw new Error("Unknown type: ".concat(t,"."))}}},{key:"GetSize",value:function(t){return t.reduce((function(t,e){return t*e}),1)}}],(n=[{key:"_compileJITMethods",value:function(){var t=this,e=function(t){for(var e=new Array(t),n=0;n<t;n+=1)e[n]=n;return e}(this.shape.length),n=e.map((function(t){return"i".concat(t)})).join(","),a="".concat(this.offset,"+").concat(e.map((function(e){return"".concat(t.stride[e],"*i").concat(e)})).join("+"));this.get=new Function("return function get(".concat(n,") { return this.data[").concat(a,"]; }"))(),this.set=new Function("return function get(".concat(n,", v) { this.data[").concat(a,"] = v; }"))(),this.index=new Function("return function get(".concat(n,", v) { return ").concat(a,"; }"))()}},{key:"_defineStride",value:function(t){for(var e=t.length,n=new Array(e),a=e-1,r=1;a>=0;a-=1)n[a]=r,r*=this.shape[a];return n}},{key:"assign",value:function(t){var e=l.DefineType(t),n=t.length;return v(e===this.dtype,"Tensor: Different dtypes assigned: \n   expected - ".concat(this.dtype," \n   actual - ").concat(e)),v(n===this.size+this.offset,"Tensor: Different sizes assigned: \n   expected - ".concat(this.size+this.offset," \n   actual - ").concat(n)),this.data=t,this}},{key:"release",value:function(){return this.empty?this.data.set(this.empty):this.data=l.Malloc(this.dtype,this.size),this}},{key:"relese",value:function(){return A("Tensor: relese"),this.release(),this}},{key:"clone",value:function(){var t=new l(this.dtype,this.shape,void 0,this.stride,this.offset);return tt(this,t),t}}])&&rt(e.prototype,n),a&&rt(e,a),l}(o);function st(t){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ut(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function ht(t,e){return(ht=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ft(t,e){return!e||"object"!==st(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function pt(t){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var dt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ht(t,e)}(o,t);var e,n,a,r,i=(a=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=pt(a);if(r){var n=pt(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return ft(this,t)});function o(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this,"MediaInput")).dtype="uint8",n.inputKeys=[],n.isInitialized=!1,n.lastCtx=Math.random(),n.cache=!0,n.assignMedia(t,e),n}return e=o,(n=[{key:"assignMedia",value:function(t,e){t&&v(w(t)||E(t),"MediaInput: Is only Video, Canvas element available as input"),e&&v(b(e),"MediaInput: Shape is invalid"),this.media=t,this.shape=e}}])&&ut(e.prototype,n),o}(o);function yt(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=new ImageData(t.shape[1],t.shape[0]),r=t.shape[0]*t.shape[1];if(e&&"uint8"===t.dtype)return a.data.set(t.data),a;if(!e){for(var i=0;i<r;i+=1){var o=~~(i/t.shape[0]),l=i-o*t.shape[1],c=t.data[i],s=0;s=n?4*(l*t.shape[0]+o):4*(o*t.shape[1]+l),a.data[s+0]=c,a.data[s+1]=c,a.data[s+2]=c,a.data[s+3]=255}return a}if("float32"===t.dtype)for(var u=0;u<t.size;u+=1)a.data[u]=255*t.data[u];else for(var h=0;h<t.size;h+=1)a.data[h]=t.data[h];return a}function gt(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!(e instanceof ct))throw Error("tensorToCanvas: Input tensor invalid");e.shape[2]&&4===e.shape[2]&&(n=!0);var r=yt(e,n,a);t.getContext("2d").putImageData(r,0,0)}var mt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgba(255, 0, 0, 0.5)",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=t.getContext("2d");r.beginPath(),Array.isArray(e)?(r.moveTo(e[0],e[1]),r.lineTo(e[2],e[3])):(r.moveTo(e.data[0],e.data[1]),r.lineTo(e.data[2],e.data[3])),r.strokeStyle=n,r.lineWidth=a,r.stroke(),r.closePath()},vt=function(t){t.getContext("2d").clearRect(0,0,t.width,t.height)};function xt(t,e){var n=t.getContext("2d");n.fillStyle=e,n.fillRect(0,0,t.width,t.height)}function bt(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function kt(t,e){return t*e}function St(t,e){return e/t}function _t(t,e,n){if(e){var a=St(t,e);if(a>n)return{width:e,height:a}}return{width:kt(t,n),height:n}}var wt=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.video=(x("video"),document.createElement("video")),this.video.muted=!0,this.video.playsInline=!0,this.canvas=O(),this.canvasCtx=this.canvas.getContext("2d"),this.sourceCanvas=O(),this.sourceCanvasCtx=this.sourceCanvas.getContext("2d"),this.width=e,this.height=n,this.sourceWidth=e,this.sourceHeight=n,this.setSize(e,n),this.track=null}var e,n,a;return e=t,a=[{key:"IsAvailable",value:function(){var t={video:{width:{min:480,ideal:1080,max:1920},height:{min:480,ideal:1080,max:1920}}};navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;var e=navigator.userAgent;-1!==e.indexOf("Safari")&&-1===e.indexOf("Chrome")&&(delete t.video.width,delete t.video.height);var n=Promise.resolve();return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?n=n.then((function(){return navigator.mediaDevices.getUserMedia(t)})):navigator.getUserMedia&&(n=n.then((function(){return new Promise((function(e){return navigator.getUserMedia(t,e)}))}))),n.then((function(t){var e=t.getTracks(),n=e[0].getSettings().deviceId;return e.forEach((function(t){return t.stop()})),n||!0})).catch((function(){return Promise.resolve(!1)}))}},{key:"getDevices",value:function(){return"mediaDevices"in navigator&&"enumerateDevices"in navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then((function(t){return t.filter((function(t){return"videoinput"===t.kind}))})):Promise.resolve(null)}}],(n=[{key:"setSize",value:function(t,e){this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e,this.sourceCanvas.width=t,this.sourceCanvas.height=e,this.sourceMinWidth=t,this.sourceMinHeight=e}},{key:"setSourceSize",value:function(t,e){var n=_t(t/e,this.width,this.height),a=function(t,e,n){if(e){var a=St(t,e);if(a<=n)return{width:e,height:a}}return{width:kt(t,n),height:n}}(this.width/this.height,t,e),r=_t(t/e,a.width,a.height);this.sourceMinWidth=n.width,this.sourceMinHeight=n.height,this.sourceWidth=r.width,this.sourceHeight=r.height,this.sourceCanvas.width=a.width,this.sourceCanvas.height=a.height}},{key:"getDevice",value:function(){return this.track?this.track.getSettings().deviceId:null}},{key:"start",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.started=!0;var a={video:{width:{min:240,ideal:1080,max:1920},height:{min:240,ideal:1080,max:1920},aspectRatio:{exact:this.width/this.height},deviceId:t?{ideal:t}:void 0,facingMode:n?{exact:n}:null}},r=navigator.userAgent,i=!(-90===window.orientation||90===window.orientation||window.offsetWidth>window.offsetHeight);/android/i.test(r)&&i&&(a.video.aspectRatio.exact=1/a.video.aspectRatio.exact),-1!==r.indexOf("Safari")&&-1===r.indexOf("Chrome")&&(delete a.video.width,delete a.video.height,delete a.video.aspectRatio),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;var o=Promise.resolve();return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?o=o.then((function(){return navigator.mediaDevices.getUserMedia(a)})):navigator.getUserMedia&&(o=o.then((function(){return new Promise((function(t){return navigator.getUserMedia(a,t)}))}))),o.then((function(t){if(t){var n=t.getTracks();return e.started?("srcObject"in e.video?e.video.srcObject=t:e.video.src=window.URL.createObjectURL(t),e.track=n[0],e.video.play().then((function(){return e.setSourceSize(e.video.videoWidth,e.video.videoHeight)}))):(n.forEach((function(t){return t.stop()})),null)}throw new Error("getUserMedia not found or no stream was created")}))}},{key:"stop",value:function(){this.started=!1,this.track&&(this.track.stop(),this.track=null)}},{key:"drawImage",value:function(t,e,n,a,r){t.drawImage(this.video,(a-e)/-2,(r-n)/-2,a,r)}},{key:"getImageBuffer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvasCtx,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.width,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.height,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:a,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:this.sourceMinWidth,s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:this.sourceMinHeight;this.drawImage(e,o,l,c,s);var u=e.getImageData(r,i,o,l);if(t instanceof ct)return t.data.set(u.data),t;switch(t){case"uint8":return new Uint8Array(u.data);case"uint8c":return u.data;case"float32":return new Float32Array(u.data);default:return u}}},{key:"getImageBufferTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.canvasCtx,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.width,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.height,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:a,c=arguments.length>8?arguments[8]:void 0;e.drawImage(this.video,(this.sourceWidth-this.width)/-2,(this.sourceHeight-this.height)/-2,this.sourceWidth,this.sourceHeight);var s=e.getImageData(r,i,o,l);c.data=s.data.buffer}},{key:"getSourceImageBuffer",value:function(t,e,n,a,r){return this.getImageBuffer(t,this.sourceCanvasCtx,this.sourceCanvas.width,this.sourceCanvas.height,e,n,a,r,this.sourceWidth,this.sourceHeight)}}])&&bt(e.prototype,n),a&&bt(e,a),t}();const Et=function(t){return new Q("Grayscale").Input("tSrc","uint8").Output("uint8").LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst vec3 k = vec3(0.2128, 0.7148, 0.0724);\n\nvec4 operation(float y, float x) {\n  float value = dot(pickValue_tSrc(y, x).rgb, k);\n\n\treturn vec4(value, value, value, 1.0);\n}\n").Compile({tSrc:t})},Tt="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst float hWidth = (KERNEL_WIDTH - 1.0) / 2.0;\nconst float hHeight = (KERNEL_HEIGHT - 1.0) / 2.0;\n\nvec4 operation(float y, float x) {\n  vec3 finalColour = vec3(0.0);\n\n  for (float dy=-hHeight; dy <= hHeight; dy += 1.0) {\n    for (float dx=-hWidth; dx <= hWidth; dx += 1.0) {\n      vec3 k = pickValue_tKernel(float(dy + hHeight), float(dx + hWidth)).rgb;\n\n      finalColour += pickValue_tSrc(y + dy, x + dx).rgb * k;\n    }\n  }\n\n  return vec4(finalColour * factor + bias, 1.0);\n}\n";function Ct(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new ct("float32",[t,t]),a=(t-1)/2,r=new ct("float32",[t,t,4]),i=0,o=0;o<t;o+=1)for(var l=0;l<t;l+=1){var c=Math.exp(-.5*(Math.pow((l-a)/e,2)+Math.pow((o-a)/e,2)))/(2*Math.PI*e*e);n.set(l,o,c),i+=n.get(l,o)}for(var s=0;s<t;s+=1)for(var u=0;u<t;u+=1)r.set(u,s,0,n.get(u,s)/i),r.set(u,s,1,n.get(u,s)/i),r.set(u,s,2,n.get(u,s)/i);return r}function Pt(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,e=new ct("float32",[t,t,4]),n=Math.pow(t,2),a=0;a<e.data.length;a+=1)e.data[a]=1/n;return e}function At(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=-1*t,n=1+4*t;return et([0,e,0,e,n,e,0,e,0],[3,3,4],"float32")}function Ot(){return et([0,0,0,0,-1,0,0,0,0],[3,3,4],"float32")}function It(){return et([1,0,-1,0,0,0,-1,0,1],[3,3,4],"float32")}function Mt(){return et([0,1,0,1,-4,1,0,1,0],[3,3,4],"float32")}function Rt(){return et([-1,-1,-1,-1,8,-1,-1,-1,-1],[3,3,4],"float32")}function Vt(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=Ct(t,e),r=~~((t-1)/2),i=1+1*n-a.get(r,r,0),o=1+1*n-a.get(r,r,1),l=1+1*n-a.get(r,r,2),c=0;c<a.size;c+=1)a.data[c]=-a.data[c];return a.set(r,r,0,i),a.set(r,r,1,o),a.set(r,r,2,l),a}const Lt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return new Q("Convolution2d").Input("tSrc",t.dtype).Input("tKernel","float32").Output(t.dtype).LoadChunk("pickValue").Constant("KERNEL_WIDTH",e.shape[1]).Constant("KERNEL_HEIGHT",e.shape[0]).Uniform("bias","float",a).Uniform("factor","float",n).GLSLKernel(Tt).Compile({tSrc:t,tKernel:e})};var Ut=r;const jt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return v(e>=3,"Kernel size should be greater equal 3"),v(n>0,"Sigma should be greater then 0"),Lt(t,Ct(e,n))},Kt="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float j, float i) {\n  float x = floor(i * TX);\n  float y = floor(j * TY);\n\n  // nearest\n  if (S == 0.0) {\n    return pickValue_tSrc(y, x);\n  }\n\n  // bicubic\n  if (S == 1.0) {\n    float dx = floor(TX * i) - x;\n    float dy = floor(TY * j) - y;\n\n    vec4 C[4];\n\n    for (float jj = 0.0; jj <= 3.0; jj += 1.0) {\n      vec4 d0 = pickValue_tSrc(y - 1.0 + jj, x - 1.0) - pickValue_tSrc(y - 1.0 + jj, x);\n      vec4 d2 = pickValue_tSrc(y - 1.0 + jj, x + 1.0) - pickValue_tSrc(y - 1.0 + jj, x);\n      vec4 d3 = pickValue_tSrc(y - 1.0 + jj, x + 2.0) - pickValue_tSrc(y - 1.0 + jj, x);\n      vec4 a0 = pickValue_tSrc(y - 1.0 + jj, x);\n      vec4 a1 = -1.0 / 3.0 * d0 + d2 - 1.0 / 6.0 * d3;\n      vec4 a2 = 1.0 / 2.0 * d0 + 1.0 / 2.0 * d2;\n      vec4 a3 = -1.0 / 6.0 * d0 + 1.0 / 2.0 * d2 + 1.0 / 6.0 * d3;\n\n      C[int(jj)] = a0 + a1 * dx + a2 * dx * dx + a3 * dx * dx * dx;\n    }\n\n    vec4 d0 = C[0] - C[1];\n    vec4 d2 = C[2] - C[1];\n    vec4 d3 = C[3] - C[1];\n    vec4 a0 = C[1];\n\n    vec4 a1 = -1.0 / 3.0 * d0 + d2 - 1.0 / 6.0 * d3;\n    vec4 a2 = 1.0 / 2.0 * d0 + 1.0 / 2.0 * d2;\n    vec4 a3 = -1.0 / 6.0 * d0 - 1.0 / 2.0 * d2 + 1.0 / 6.0 * d3;\n\n    vec4 Cc = a0 + a1 * dy + a2 * dy * dy + a3 * dy * dy  * dy;\n\n    return Cc;\n  }\n}\n",zt=function(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"nearest";v("nearest"===a||"bicubic"===a||"mean"===a||"max"===a,'ResizeOperation: Unsupported type of operation. Currently supported only "nearest" and "bicubic"'),"mean"===a&&(A('ResizeOperation: type "mean"','use "bicubic" instead'),a="bicubic"),"max"===a&&(A('ResizeOperation: type "max"','use "nearest" instead'),a="nearest"),v(e>0||n>0,"ResizeOperation: Size of image should be greater than 0");var r=0;return"nearest"===a?r=0:"bicubic"===a&&(r=1),new Q("Resize").Input("tSrc",t.dtype).Output(t.dtype).Constant("TX",t.shape[1]/e).Constant("TY",t.shape[0]/n).Constant("S",r).SetShapeFn((function(){var t=[n,e,4];return v(P(t),"ResizeOperation: Invalid operation shape"),t})).LoadChunk("pickValue").GLSLKernel(Kt).Compile({tSrc:t})},Bt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",a=~~(t.shape[1]/e),r=~~(t.shape[0]/e);return zt(t,a,r,n)},Ft=function(t){return new Q("SobelOperator").Input("tSrc",t.dtype).Output("float32").Uniform("uWidth","float",t.shape[0]).Uniform("uHeight","float",t.shape[1]).Constant("PI",Math.PI).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  float wk = 1.0;\n  float hk = 1.0;\n\n  float dx = 0.0;\n  float dy = 0.0;\n\n  /*\n    -1 0 +1\n    -2 0 +2\n    -1 0 +1\n  */\n  dx += -1.0 * pickScalarValue_tSrc(y - hk, x - wk);\n  dx += -2.0 * pickScalarValue_tSrc(y,      x - wk);\n  dx += -1.0 * pickScalarValue_tSrc(y + wk, x - wk);\n\n  dx += +1.0 * pickScalarValue_tSrc(y - wk, x + wk);\n  dx += +2.0 * pickScalarValue_tSrc(y,      x + wk);\n  dx += +1.0 * pickScalarValue_tSrc(y + wk, x + wk);\n\n  /*\n    -1 -2 -1\n     0  0  0\n    +1 +2 +1\n  */\n  dy += -1.0 * pickScalarValue_tSrc(y - wk, x - wk);\n  dy += -2.0 * pickScalarValue_tSrc(y - wk, x    );\n  dy += -1.0 * pickScalarValue_tSrc(y - wk, x + wk);\n\n  dy += +1.0 * pickScalarValue_tSrc(y + wk, x - wk);\n  dy += +2.0 * pickScalarValue_tSrc(y + wk, x    );\n  dy += +1.0 * pickScalarValue_tSrc(y + wk, x + wk);\n\n  float magniture = sqrt((dx * dx) + (dy * dy));\n  float theta = atan(dy / dx);\n\n\treturn vec4(magniture, dx, dy, theta);\n}\n").LoadChunk("pickValue").Compile({tSrc:t})};var Nt=function(t){return new Q("HOGDirection").Input("tSrc","uint8").Output("float32").Uniform("uWidth","float",t.shape[1]).Uniform("uHeight","float",t.shape[0]).LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  float dx = pickValue_tSrc(y, x + 1.0).r - pickValue_tSrc(y, x - 1.0).r;\n  float dy = pickValue_tSrc(y + 1.0, x).r - pickValue_tSrc(y - 1.0, x).r;\n\n  float magniture = sqrt((dx * dx) + (dy * dy));\n\n\treturn vec4(magniture, atan(dy / dx), dx, dy);\n}").Compile({tSrc:t})},Dt=function(t,e){return new Q("HOG").Input("tSrc","uint8").Output("float32").Uniform("uSrcWidth","float",t.shape[1]).Uniform("uSrcHeight","float",t.shape[0]).Uniform("uWidth","float",3*~~(t.shape[1]/e)).Uniform("uHeight","float",3*~~(t.shape[0]/e)).Constant("PI",Math.PI).Constant("W",~~(t.shape[1]/e)).Constant("H",~~(t.shape[0]/e)).Constant("K",e).LoadChunk("pickValue").SetShapeFn((function(){return[3*~~(t.shape[0]/e),3*~~(t.shape[1]/e),4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nfloat A = 180.0 / 9.0; // size of channel in deg\nfloat S = 3.0;\n\nvec4 operation(float y, float x) {\n  float my = y - (S * floor(y / S));\n  float mx = x - (S * floor(x / S));\n\n  x = x / S;\n  y = y / S;\n  float index = mx + (my * S);\n\n  float sum = 0.0;\n\n  for (float dx = 0.0; dx < K; dx += 1.0) {\n    for (float dy = 0.0; dy < K; dy += 1.0) {\n      vec4 v = pickValue_tSrc(((y * K) + dy), ((x * K) + dx));\n\n        float theta = abs(PI / 2.0 - v.g);\n        float deg = theta * (180.0 / PI);\n        float i = floor(deg / A);\n\n      if (i == index) {\n        sum += v.r;\n      }\n    }\n  }\n\n   float rad = (index / 9.0 * PI);\n\n   return vec4(sum, rad, 0.0, 0.0);\n}\n").Compile({tSrc:t})},Gt=function(t,e){return new Q("HOGMax").Input("tSrc","uint8").Output("float32").Uniform("uSrcWidth","float",t.shape[1]).Uniform("uSrcHeight","float",t.shape[0]).Uniform("uWidth","float",~~(t.shape[1]/e)).Uniform("uHeight","float",~~(t.shape[0]/e)).Constant("PI",Math.PI).Constant("W",~~(t.shape[1]/e)).Constant("H",~~(t.shape[0]/e)).Constant("K",e).LoadChunk("pickValue").SetShapeFn((function(){return[~~(t.shape[0]/e),~~(t.shape[1]/e),4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int w = int(W);\nconst int h = int(H);\nconst int k = int(K);\nconst float S = 3.0;\nfloat A = 180.0 / 9.0; // size of channel in deg\n\nvec4 getPixel(float y, float x) {\n  float x1 = x / float(w);\n  float y1 = y / float(h);\n\n  return pickValue_tSrc(floor(y1 * uSrcHeight), floor(x1 * uSrcWidth));\n}\n\nvec4 getPixel(float y, float x, float xOffset, float yOffset) {\n  float x1 = x / float(w);\n  float y1 = y / float(h);\n\n  return pickValue_tSrc(floor(y1 * uSrcHeight) + yOffset, floor(x1 * uSrcWidth) + xOffset);\n}\n\nvec4 operation(float y, float x) {\n   float x1 = x / W;\n   float y1 = y / H;\n   float res = 0.0;\n   float tmpx = x / S;\n   float tmpy = y / S;\n   float sum[9];\n   int count = 0;\n\n   vec4 value = getPixel(y, x);\n\n   for (int _x = 0; _x < k; _x += 1) {\n      for (int _y = 0; _y < k; _y += 1) {\n        vec4 v = getPixel(y, x, float(_y), float(_x));\n\n        float theta = abs(PI / 2.0 - v.g);\n        float deg = theta * (180.0 / PI);\n        int i = int(floor(deg / A));\n\n        // if (i == 0) {\n        //   sum[0] += v.r;\n        // }\n        if (i == 1) {\n          sum[1] += v.r;\n        }\n        if (i == 2) {\n          sum[2] += v.r;\n        }\n        if (i == 3) {\n          sum[3] += v.r;\n        }\n        if (i == 4) {\n          sum[4] += v.r;\n        }\n        if (i == 5) {\n          sum[5] += v.r;\n        }\n        if (i == 6) {\n          sum[6] += v.r;\n        }\n        if (i == 7) {\n          sum[7] += v.r;\n        }\n        if (i == 8) {\n          sum[8] += v.r;\n        }\n      }\n   }\n\n   int maxI = 0;\n   float maxV = 0.0;\n\n   for (int i = 0; i < 9; i++) {\n      if (maxV < sum[i]) {\n        maxI = i;\n        maxV = sum[i];\n      }\n   }\n\n   return vec4(maxI, maxV, 0.0, 0.0);\n}\n").Compile({tSrc:t})};const Ht=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"max";v("max"===n||"visualize"===n,"Unsupported type of HOG operation.\n     Currently availiable max and visualize.");var a=null;return"max"===n&&(a=Gt(Nt(t),e)),"visualize"===n&&(a=Dt(Nt(t),e)),a},Wt="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n\treturn pickValue_tSrc(y, x);\n}\n",Xt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.dtype;return new Q("Cast").Input("tSrc",t.dtype).Output(e).LoadChunk("pickValue").GLSLKernel(Wt).Compile({tSrc:t})};var Zt=function(t){return new Q("ImageCannyEdgesNMS").Input("tSrc",t.dtype).Output(t.dtype).LoadChunk("pickValue").Uniform("uSize","float",1).Constant("PI",Math.PI).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\n#define STROKE uSize\n\nvec4 operation(float y, float x) {\n  vec4 M = pickValue_tSrc(y, x);\n  float N = pickValue_tSrc(y + STROKE, x).r;\n  float S = pickValue_tSrc(y - STROKE, x).r;\n  float W = pickValue_tSrc(y, x - STROKE).r;\n  float E = pickValue_tSrc(y, x + STROKE).r;\n\n  float SE = pickValue_tSrc(y - STROKE, x + STROKE).r;\n  float NW = pickValue_tSrc(y + STROKE, x - STROKE).r;\n\n  float NE = pickValue_tSrc(y + STROKE, x + STROKE).r;\n  float SW = pickValue_tSrc(y - STROKE, x - STROKE).r;\n  float H = 0.0;\n\n  float V = M.r;\n  float dx = M.g;\n  float dy = M.b;\n\n  float theta = atan(dy / dx);\n  float deg = theta * (180.0 / PI);\n  float angle = 0.0;\n\n  if (deg < 0.0) {\n    deg = 180.0 + deg;\n  }\n\n  if (deg < 22.5 || deg >= 157.5) {\n    // 0 deg\n    if (V > W && V > E) {\n      H += 1.0;\n    }\n  }\n\n  if (deg < 67.5 && deg >= 22.5) {\n    // 45 deg\n    if (V > SW && V > NE) {\n      H += 1.0;\n    }\n  }\n\n  if (deg < 112.5 && deg >= 67.5) {\n    // 90 deg\n    if (V > N && V > S) {\n      H += 1.0;\n    }\n  }\n\n  if (deg < 157.5 && deg >= 112.5) {\n    // 135 deg\n    if (V > NW && V > SE) {\n      H += 1.0;\n    }\n  }\n\n  if (H == 1.0) {\n    return vec4(V, V, V, 255);\n  } else {\n    return vec4(0, 0, 0, 255);\n  }\n}").Compile({tSrc:t})},Yt=function(t,e,n){return v(e>=0,"Canny low threshold should be greater equal 0"),v(n<=1,"Canny high threshold should be less equal 1"),new Q("ImageCannyEdgesHysteresis").Input("tSrc",t.dtype).Output(t.dtype).LoadChunk("pickValue").Uniform("uSize","float",1).Uniform("uThresholdLow","float",e).Uniform("uThresholdHigh","float",n).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\n#define STROKE uSize\n\nvec4 operation(float y, float x) {\n  vec4 M = pickValue_tSrc(y, x);\n  float N = pickValue_tSrc(y + STROKE, x).r;\n  float S = pickValue_tSrc(y - STROKE, x).r;\n  float W = pickValue_tSrc(y, x - STROKE).r;\n  float E = pickValue_tSrc(y, x + STROKE).r;\n\n  float SE = pickValue_tSrc(y - STROKE, x + STROKE).r;\n  float NW = pickValue_tSrc(y + STROKE, x - STROKE).r;\n\n  float NE = pickValue_tSrc(y + STROKE, x + STROKE).r;\n  float SW = pickValue_tSrc(y - STROKE, x - STROKE).r;\n  float V = M.r;\n  float H = 0.0;\n\n  if (V > uThresholdHigh) {\n    H += 1.0;\n  }\n\n  if (V > uThresholdLow && V < uThresholdHigh) {\n    if (\n      N > 0.0 ||\n      S > 0.0 ||\n      W > 0.0 ||\n      E > 0.0 ||\n      SE > 0.0 ||\n      NW > 0.0 ||\n      NE > 0.0 ||\n      SW > 0.0\n    ) {\n      H += 1.0;\n    }\n  }\n\n  if (H == 1.0) {\n    return vec4(255, 255, 255, 255);\n  } else {\n    return vec4(0, 0, 0, 255);\n  }\n}\n").Compile({tSrc:t})};const qt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.75;return Yt(Zt(t),e,n)},Jt="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst float _step = 1.0 / CLUSTERS;\n\nvec4 operation(float y, float x) {\n  float minDistance = 256.0;\n  float label = 0.0;\n  vec3 value = pickValue_tSrc(y, x).rgb;\n\n  for (int i = 0; i < int(CLUSTERS); i += 1) {\n    vec3 curr = pickValue_tCentroids(float(i), 0.0).rgb;\n    float distance = sqrt(((value.r - curr.r) * (value.r - curr.r)));\n\n    if (distance < minDistance) {\n      minDistance = distance;\n      label = float(i) / CLUSTERS;\n    }\n  }\n\n  return vec4(label, label, label, 1.0);\n}\n",Qt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return v("uint8"===t.dtype,"Color Segmentation currently available for uint8 image input"),v(e>1,"Number of clusters should be greater than 1"),new Q("ImageColorSegmentation").Input("tSrc","uint8").Input("tCentroids","uint8").Output("uint8").LoadChunk("pickValue").Constant("CLUSTERS",e).GLSLKernel(Jt).PreCompile((function(t){var n=~~(256/e);t.centroids=new ct("uint8",[e,1,4]);for(var a=0;a<e;a+=1)t.centroids.set(a,0,0,a*n);t.assignInput("tCentroids",t.centroids)})).Compile({tSrc:t})};function $t(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1],n=t,a=0;a<e.length;a+=1)n/=e[a];return 1===n}function te(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,1],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[[1,1]];return $t(t[0],e.map((function(t){return t[0]})))&&$t(t[0],e.map((function(t){return t[1]})))}function ee(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,r=Math.pow(t,1/e);if(t%1!=0)throw new RangeError("Can't get parallel reduction steps for non-integer, got \"".concat(t,'"'));if(a<1)throw new RangeError("Can't get parallel reduction steps for maxLayerSize below less than 1, got \"".concat(a,'"'));if(r%1==0&&r<a)return new Array(e).fill(r);for(var i=[],o=t,l=r,c=0;c<e;c+=1){l=Math.pow(o,1/(e-c));for(var s=Math.ceil(l);(o%s!=0||o/s>a)&&o/s!=1;)s+=1;if(1===s&&n)break;o/=s,i.push(s)}return i}function ne(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[1,1],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,r=ee(t[0],e,n,a[0]),i=ee(t[1],e,n,a[1]),o=[],l=0;l<e&&(r[l]||i[l]);l+=1)o.push([r[l]||1,i[l]||1]);return o}var ae=function(t,e){return new Q("ImageReduceStd").Input("tStd",t.dtype).Output(t.dtype).Constant("WIDTH",t.shape[1]).Constant("HEIGHT",t.shape[0]).Uniform("uWidth","float",t.shape[1]/e[1]).Uniform("uHeight","float",t.shape[0]/e[0]).Constant("KX",e[1]).Constant("KY",e[0]).LoadChunk("pickValue").SetShapeFn((function(){return[~~(t.shape[0]/e[0]),~~(t.shape[1]/e[1]),4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int kx = int(KX);\nconst int ky = int(KY);\nconst int w = int(WIDTH);\nconst int h = int(HEIGHT);\n\nvec4 operation(float gly, float glx) {\n float size = KX * KY;\n\n vec3 std = vec3(0.0, 0.0, 0.0);\n\n  for (int y = 0; y < ky; y += 1) {\n    for (int x = 0; x < kx; x += 1) {\n      vec3 mstd = pickValue_tStd(gly * KY + float(y), glx * KX + float(x)).rgb;\n      std += mstd * mstd;\n    }\n  }\n\n  std /= size;\n  std = sqrt(std);\n\n  if (std.r == 0.0) {\n    std.r = 255.0;\n  }\n\n  if (std.g == 0.0) {\n    std.g = 255.0;\n  }\n\n  if (std.b == 0.0) {\n    std.b = 255.0;\n  }\n\n  return vec4(std, 255.0);\n}\n").Compile({tStd:t})},re=function(t,e,n){return new Q("ImageExtractStd").Input("tSrc",t.dtype).Input("tMean",e.dtype).Output(t.dtype).Constant("WIDTH",t.shape[1]).Constant("HEIGHT",t.shape[0]).Uniform("uWidth","float",t.shape[1]/n[1]).Uniform("uHeight","float",t.shape[0]/n[0]).Constant("KX",n[1]).Constant("KY",n[0]).LoadChunk("pickValue").SetShapeFn((function(){return[~~(t.shape[0]/n[0]),~~(t.shape[1]/n[1]),4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int kx = int(KX);\nconst int ky = int(KY);\nconst int w = int(WIDTH);\nconst int h = int(HEIGHT);\n\nvec4 operation(float gly, float glx) {\n float size = KX * KY;\n\n vec3 std = vec3(0.0, 0.0, 0.0);\n vec3 mean = pickValue_tMean(0.0, 0.0).rgb;\n\n  for (int y = 0; y < ky; y += 1) {\n    for (int x = 0; x < kx; x += 1) {\n      vec3 value = pickValue_tSrc(gly * KY + float(y), glx * KX + float(x)).rgb;\n      std += (value - mean) * (value - mean);\n    }\n  }\n\n  std /= size;\n  std = sqrt(std);\n\n  if (std.r == 0.0) {\n    std.r = 255.0;\n  }\n\n  if (std.g == 0.0) {\n    std.g = 255.0;\n  }\n\n  if (std.b == 0.0) {\n    std.b = 255.0;\n  }\n\n  return vec4(std, 255.0);\n}\n").Compile({tSrc:t,tMean:e})},ie=function(t,e){return new Q("ImageExtractMean").Input("tSrc",t.dtype).Output(t.dtype).Constant("WIDTH",t.shape[1]).Constant("HEIGHT",t.shape[0]).Uniform("uWidth","float",t.shape[1]/e[1]).Uniform("uHeight","float",t.shape[0]/e[0]).Constant("KX",e[1]).Constant("KY",e[0]).LoadChunk("pickValue").SetShapeFn((function(){return[~~(t.shape[0]/e[0]),~~(t.shape[1]/e[1]),4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int kx = int(KX);\nconst int ky = int(KY);\nconst int w = int(WIDTH);\nconst int h = int(HEIGHT);\n\nvec4 operation(float gly, float glx) {\n float size = KY * KX;\n float mean = 0.0;\n float std = 0.0;\n\n vec3 color = vec3(0.0, 0.0, 0.0);\n\n  for (int y = 0; y < ky; y += 1) {\n    for (int x = 0; x < kx; x += 1) {\n      vec3 value = pickValue_tSrc(gly * KY + float(y), glx * KX + float(x)).rgb;\n      color += value.rgb;\n    }\n  }\n\n  color /= size;\n\n  mean = color.r;\n\n  for (int y = 0; y < ky; y += 1) {\n    for (int x = 0; x < kx; x += 1) {\n      vec3 value = pickValue_tSrc(gly * KY + float(y), glx * KX + float(x)).rgb;\n      std += (value.r - mean) * (value.r - mean);\n    }\n  }\n\n  std /= size;\n  std = sqrt(std);\n\n  if (std == 0.0) {\n    std = 1.0;\n  }\n\n  return vec4(color, 255.0);\n}\n").Compile({tSrc:t})},oe=function(t,e){return new Q("ImageJoin").Input("tMean",t.dtype).Input("tStd",e.dtype).Output(t.dtype).SetShapeFn((function(){return[2,1,4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float gly, float glx) {\n if (gly == 0.0) {\n    return texture2D(tMean, vec2(0, 0));\n } else {\n    return texture2D(tStd, vec2(0, 0));\n }\n}\n").Compile({tMean:t,tStd:e})};const le=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2?arguments[2]:void 0,a=[[t.shape[0],t.shape[1]]];Array.isArray(e)?(v(te(t.shape,e),"ImageMeanStd: Provided steps doesn't converge in 1 px in ImageExtractMeanStd operation"),a=e):"number"==typeof e&&e>0&&(a=ne(t.shape,e));for(var r=ie(t,a[0]),i=1;i<a.length;i+=1)r=ie(r,a[i]);if(n)return r;for(var o=re(t,r,a[0]),l=1;l<a.length;l+=1)o=ae(o,a[l]);return oe(r,o)};var ce=function(t,e,n,a,r,i){return new Q("ImageExtractHistogram").Input("tSrc",t.dtype).Output("float32").Constant("KX",e[1]).Constant("KY",e[0]).LoadChunk("pickValue").Constant("MIN",n).Constant("MAX",a).Constant("STEP",r).Constant("COUNT",i).SetShapeFn((function(){return[~~(t.shape[0]/e[0]),~~(t.shape[1]/e[1])*i,4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int kx = int(KX);\nconst int ky = int(KY);\n\nprecision highp float;\n\nvec4 operation(float gly, float iglx) {\n  float size = KX * KY;\n  float glx = floor(iglx / COUNT);\n  float currentIndex = iglx - (glx * COUNT);\n\n  vec4 count = vec4(0.0);\n  vec4 ones = vec4(1.0);\n  vec4 twos = vec4(2.0);\n  vec4 currentIndex4 = vec4(currentIndex);\n  vec4 value;\n\n  for (int y = 0; y < ky; y += 1) {\n    for (int x = 0; x < kx; x += 1) {\n      value = pickValue_tSrc(gly * KY + float(y), glx * KX + float(x));\n      vec4 index = floor((value - MIN) / STEP + 0.5);      \n\n      count += step(twos, ones / (abs(index - currentIndex4)));\n    }\n  }\n\n  return count;\n}\n").Compile({tSrc:t})},se=function(t,e,n){return new Q("ImageReduceHistogram").Input("tSrc","float32").Output("float32").Constant("KX",e[1]).Constant("KY",e[0]).LoadChunk("pickValue").Constant("COUNT",n).SetShapeFn((function(){return[~~(t.shape[0]/e[0]),~~(t.shape[1]/e[1]),4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int kx = int(KX);\nconst int ky = int(KY);\n\nvec4 operation(float gly, float iglx) {\n  float size = KX * KY;\n  float glx = floor(iglx / COUNT);\n  float currentIndex = iglx - (glx * COUNT);\n\n  vec4 count = vec4(0.0);\n\n  for (int y = 0; y < ky; y += 1) {\n    for (int x = 0; x < kx; x += 1) {\n      count += pickValue_tSrc(gly * KY + float(y), (glx * KX + float(x)) * COUNT + currentIndex);\n    }\n  }\n\n  return count;\n}\n").Compile({tSrc:t})};const ue=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/255,i=[[t.shape[0],t.shape[1]]],o=~~((a-n+r)/r);Array.isArray(e)?(v(te(t.shape,e),"ImageExtractHistogram: Provided steps doesn't converge in 1 px in operation"),i=e):"number"==typeof e&&e>0&&(i=ne(t.shape,e,!0,[R.MAX_TEXTURE_SIZE,R.MAX_TEXTURE_SIZE/256/(R.SUPPORTS_FLOAT_TEXTURES?1:4)]));for(var l=ce(t,i[0],n,a,r,o),c=1;c<i.length;c+=1)l=se(l,i[c],o);return l};var he=function(t,e){return new Q("ImageExtractMinMax").Input("tSrc",t.dtype).Output(t.dtype).Constant("KX",e[1]).Constant("KY",e[0]).LoadChunk("pickValue").SetShapeFn((function(){return[2*~~(t.shape[0]/e[0]),~~(t.shape[1]/e[1]),4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int kx = int(KX);\nconst int ky = int(KY);\nconst float INF = 1.0 / 0.0;\nconst float h2 = OUT_VIEW.y / 2.0;\n\nvec4 operation(float igly, float glx) {\n  float size = KX * KY;\n  vec3 minV = vec3(INF);\n  vec3 maxV = vec3(-INF);\n  float gly = igly;\n\n  if (gly >= h2) {\n    gly -= h2;\n  }\n\n  for (int y = 0; y < ky * 2; y += 1) {\n    for (int x = 0; x < kx; x += 1) {\n      vec3 value = pickValue_tSrc(gly * KY + float(y), glx * KX + float(x)).rgb;\n      minV = min(minV, value.rgb);\n      maxV = max(maxV, value.rgb);\n    }\n  }\n\n  if (igly < h2) {\n    return vec4(minV, 255.0);\n  } else {\n    return vec4(maxV, 255.0);\n  }\n}\n").Compile({tSrc:t})},fe=function(t,e){return new Q("ImageReduceMinMax").Input("tSrc",t.dtype).Output(t.dtype).Constant("KX",e[1]).Constant("KY",e[0]).LoadChunk("pickValue").SetShapeFn((function(){return[~~(t.shape[0]/e[0]),~~(t.shape[1]/e[1]),4]})).GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int kx = int(KX);\nconst int ky = int(KY);\nconst float INF = 1.0 / 0.0;\nconst float h2 = OUT_VIEW.y / 2.0;\n\nvec4 operation(float gly, float glx) {\n float size = KX * KY;\n\n vec3 minV = vec3(INF);\n vec3 maxV = vec3(-INF);\n vec3 value;\n\n  for (int y = 0; y < ky; y += 1) {\n    for (int x = 0; x < kx; x += 1) {\n      value = pickValue_tSrc(gly * KY + float(y), glx * KX + float(x)).rgb;\n      minV = min(minV, value);\n      maxV = max(maxV, value);\n    }\n  }\n\n  if (gly < h2) {\n    return vec4(minV, 255.0);\n  }\n\n  return vec4(maxV, 255.0);\n}\n").Compile({tSrc:t})};const pe=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[[t.shape[0],t.shape[1]]];Array.isArray(e)?(v(te(t.shape,e),"ImageMeanStd: Provided steps doesn't converge in 1 px in ImageExtractMeanStd operation"),n=e):"number"==typeof e&&e>0&&(n=ne(t.shape,e));for(var a=he(t,n[0]),r=1;r<n.length;r+=1)a=fe(a,n[r]);return a},de="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 col = pickValue_tSrc(y, x) * 255.0;\n  float res = 0.0;\n\n  if ((col.r > uRThreshold) && (col.g > uGThreshold) && (col.b > uBThreshold)\n      && (col.r > col.g) && (col.r > col.b)\n      && (col.r - min(col.g, col.b) > uRtoMinDiffThreshold)\n      && (abs(col.r - col.g) > uRtoGDiffThreshold)) {\n    res = 1.0;\n  }\n\n  return vec4(res, 0.0, 0.0, 1.0);\n}\n",ye=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Q("SkinTest").Input("tSrc",t.dtype).Output(t.dtype).Uniform("uRThreshold","float",e.uRThreshold||95).Uniform("uGThreshold","float",e.uGThreshold||40).Uniform("uBThreshold","float",e.uBThreshold||20).Uniform("uRtoMinDiffThreshold","float",e.uRtoMinDiffThreshold||15).Uniform("uRtoGDiffThreshold","float",e.uRtoGDiffThreshold||15).LoadChunk("pickValue").GLSLKernel(de).Compile({tSrc:t})};var ge=function(t,e){return new Q("l2Norm").Input("tSrc","uint8").Input("tStdMean","uint8").Output("uint8").LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec3 chanels = pickValue_tSrc(y, x).rgb;\n  vec3 mean = pickValue_tStdMean(0.0, 0.0).rgb;\n  vec3 std = pickValue_tStdMean(1.0, 0.0).rgb;\n  vec3 value = (chanels - mean) / std;\n\n\treturn vec4(value, 1.0);\n}\n").Compile({tSrc:t,tStdMean:e})},me=function(t,e){return new Q("minMaxNorm").Input("tSrc","uint8").Input("tMinMax","uint8").Output("uint8").LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec3 chanels = pickValue_tSrc(y, x).rgb;\n  vec3 minV = pickValue_tMinMax(0.0, 0.0).rgb;\n  vec3 maxV = pickValue_tMinMax(1.0, 0.0).rgb;\n  vec3 value = (chanels - minV) / (maxV - minV);\n\n\treturn vec4(value, 1.0);\n}\n").Compile({tSrc:t,tMinMax:e})};const ve=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;v("l2"===e||"minmax"===e,"Unsupported type of normalization operation.\n     Currently availiable max and visualize.");var a=null;return"l2"===e&&(a=ge(t,le(t,n))),"minmax"===e&&(a=me(t,pe(t,n))),a};var xe=function(t){return new Q("histogramCumulation").Input("tSrc","float32").Output("float32").LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 sum = vec4(0.0);\n\n  for (float i = 0.0; i < 255.0; i += 1.0) {\n    vec4 value = pickValue_tSrc(0.0, i);\n\n    if (i <= x) {\n      sum += value;\n    } else {\n      break;\n    }\n  }\n\n\treturn sum;\n}\n").Compile({tSrc:t})},be=function(t,e){return new Q("histogramEqualization").Input("tSrc","uint8").Input("tHist","float32").Output("uint8").LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst float norm = 1.0 / (OUT_VIEW.x * OUT_VIEW.y);\n\nvec4 operation(float y, float x) {\n  vec4 histBase = pickValue_tSrc(y, x) * 255.0;\n  float r = pickValue_tHist(0.0, histBase.r).r;\n  float g = pickValue_tHist(0.0, histBase.g).g;\n  float b = pickValue_tHist(0.0, histBase.b).b;\n  float a = pickValue_tHist(0.0, histBase.a).a;\n\n\treturn vec4(r, g, b, 255.0 / norm) * norm;\n}\n").Compile({tSrc:t,tHist:e})};const ke=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return be(t,xe(ue(t,e)))},Se="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nprecision highp float;\n\nfloat intersectionX(vec4 line, float x) {\n  return ((x - line.x) / (line.z - line.x) * (line.w - line.y) + line.y);\n}\n\nfloat intersectionY(vec4 line, float y) {\n  return ((y - line.y) / (line.w - line.y) * (line.z - line.x) + line.x);\n}\n\nvec4 findSide(float x1, float y1, float x2, float y2) {\n  int i = 0;\n  vec2 i0 = vec2(0, 0);\n  vec2 i1 = vec2(0, 0);\n\n  float ax = 0.0;\n  float ay = intersectionY(vec4(x1, y1, x2, y2), ax);\n\n  float by = 0.0;\n  float bx = intersectionX(vec4(x1, y1, x2, y2), by);\n\n  float cx = MAX_DIST;\n  float cy = intersectionY(vec4(x1, y1, x2, y2), cx);\n\n  float dy = MAX_DIST;\n  float dx = intersectionX(vec4(x1, y1, x2, y2), dy);\n\n  if (ay <= MAX_DIST && ay >= 0.0) {\n    if (i == 0) {\n      i0 = vec2(ax, ay);\n      i += 1;\n    }\n  }\n\n  if (cy <= MAX_DIST && cy >= 0.0) {\n    if (i == 0) {\n      i0 = vec2(cx, cy);\n      i += 1;\n    } else {\n      i1 = vec2(cx, cy);\n    }\n  }\n\n  if (bx <= MAX_DIST && bx >= 0.0) {\n    if (i == 0) {\n      i0 = vec2(bx, by);\n      i += 1;\n    } else {\n      i1 = vec2(bx, by);\n    }\n  }\n\n  if (dx <= MAX_DIST && dx >= 0.0) {\n    if (i == 0) {\n      i0 = vec2(dx, dy);\n      i += 1;\n    } else {\n      i1 = vec2(dx, dy);\n    }\n  }\n\n  return vec4(i0.x, i0.y, i1.x, i1.y);\n}\n\nfloat pow(float a) {\n  return a * a;\n}\n\nvec4 getStraight(float aIndex, float v, float dist, float angles) {\n  float y1;\n  float y2;\n  if (aIndex > angles) {\n    aIndex -= angles;\n    y1 = MAX_ANGLE - (angles * v / aIndex);\n    y2 = (-1.0 + angles / aIndex) * uWidth + y1;\n  } else {\n    aIndex = angles - aIndex;\n    y1 = (angles * v / aIndex);\n    y2 = (1.0 - angles / aIndex) * uWidth + y1;\n  }\n\n  return vec4(0.0, y1, uWidth, y2);\n}\n\nfloat getValue(float i, float lx, float ly, vec4 side) {\n  float xx = 0.0;\n  float yy = 0.0;\n\n  if (lx < ly) {\n    xx = i;\n    yy = intersectionY(side, xx);\n  } else {\n    yy = i;\n    xx = intersectionX(side, yy);\n  }\n\n  if (xx > 0.0 && xx < uWidth && yy > 0.0 && yy < uHeight) {\n    float a = pickScalarValue_tSrc(floor(yy), floor(xx));\n\n    if (a > 0.0) {\n      return 1.0;\n    }\n  }\n\n  return 0.0;\n}\n\nvec4 operation(float y, float x) {\n  float v_out = 0.0;\n\n  vec4 straight = getStraight(x, y, MAX_DIST, MAX_ANGLE / 2.0);\n  vec4 side = findSide(straight.x, straight.y, straight.z, straight.w);\n\n  float lx = abs(side.z - side.x);\n  float ly = abs(side.w - side.y);\n  float k = 1.0 / D;\n\n  for (float i = 0.0; i <= D; i += STEP) {\n    float a = getValue(i, lx, ly, side);\n\n    if (a > 0.0) {\n      v_out += k;\n    }\n  }\n\n  return vec4(v_out, v_out, v_out, 255.0);\n}",_e="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int w = int(W);\nconst int h = int(H);\n\nvec4 operation(float _y, float _x) {\n  float mmax = 0.0;\n  float maxX = 0.0;\n  float maxY = 0.0;\n  float sy = _y * H;\n  float sx = _x * W;\n  float yLimit = O_HEIGHT - sy;\n  float xLimit = O_WIDTH - sx;\n  vec4 value;\n\n  for (float y = 0.0; y < H; y += 1.0) {\n    if (y >= yLimit) {\n      break;\n    }\n    for (float x = 0.0; x < W; x += 1.0) {\n      if (x >= xLimit) {\n        break;\n      }\n      value = pickValue_tSrc(y + sy, x + sx);\n\n      if (value.r >= mmax) {\n        mmax = value.r;\n\n        if (uF < 0.5) {\n          maxX = x + sx;\n          maxY = y + sy;\n        } else {\n          maxX = value.g;\n          maxY = value.b;\n        }\n      }\n    }\n  }\n\n  return vec4(mmax, maxX, maxY, 255.0);\n}\n";var we=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=~~(t.shape[0]/e),r=~~(t.shape[1]/e),i=Math.ceil(Math.max(t.shape[0]/a,t.shape[1]/r));return new Q("ReduceMax").Input("tSrc",n?"float32":"uint8").Output("float32").Uniform("uF","float",n).LoadChunk("pickValue").Constant("W",i).Constant("H",i).Constant("O_WIDTH",t.shape[1]).Constant("O_HEIGHT",t.shape[0]).Constant("K",1/i).SetShapeFn((function(){return[Math.ceil(t.shape[0]/i),Math.ceil(t.shape[1]/i),4]})).GLSLKernel(_e).Compile({tSrc:t})},Ee=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.max(t.shape[0],t.shape[1]);return new Q("PCLinesTransform").Input("tSrc","float32").Output("uint8").Uniform("uWidth","float",t.shape[1]).Uniform("uHeight","float",t.shape[0]).Constant("PI",Math.PI).Constant("D",n).Constant("STEP",e).Constant("MAX_DIST",n).Constant("MAX_ANGLE",n).LoadChunk("pickValue").SetShapeFn((function(){return[n,n,4]})).GLSLKernel(Se).Compile({tSrc:t})};const Te=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=Ee(t,n);r=we(r,a);for(var i=0;i<e;i+=1)r=we(r,a,1);return r},Ce="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec3 rgb2hsv(vec3 c) {\n    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n\n    float d = q.x - min(q.w, q.y);\n    float e = 1.0e-10;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\n\nvec4 operation(float y, float x) {\n  return vec4(rgb2hsv(pickValue_tSrc(y, x).rgb), 1);\n}",Pe="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec4 operation(float y, float x) {\n  return vec4(hsv2rgb(pickValue_tSrc(y, x).rgb), 1);\n}",Ae=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rgb_to_hsv";v("rgb_to_hsv"===e||"hsv_to_rgb"===e,"Unsupported type ".concat(e,", currenlty avaliable: rgb_to_hsv, hsv_to_rgb."));var n=null;return"rgb_to_hsv"===e&&(n=Ce),"hsv_to_rgb"===e&&(n=Pe),new Q("HSV").Input("tSrc",t.dtype).Output(t.dtype).LoadChunk("pickValue").GLSLKernel(n).Compile({tSrc:t})},Oe="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n\tvec4 pixel = pickValue_tSrc(y, x);\n\n\tif (pixel[int(C)] > uT) {\n\t\treturn vec4(1.0, 1.0, 1.0, 1.0);\n\t} else {\n\t\treturn vec4(0.0, 0.0, 0.0, 1.0);\n\t}\n}\n",Ie=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return v("number"==typeof e,"Only number available as a threshold value."),v(0===n||1===n||2===n||3===n,"Only RGBA available: 0, 1, 2, 3"),new Q("Threshold").Input("tSrc",t.dtype).Output(t.dtype).Constant("C",n).Uniform("uT","float",e).LoadChunk("pickValue").GLSLKernel(Oe).Compile({tSrc:t})},Me="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\n\nfloat HKW = floor(KW / 2.0);\nfloat HKH = floor(KW / 2.0);\n\nvec4 operation(float y, float x) {\n  float R = 10000.0;\n  float G = 10000.0;\n  float B = 10000.0;\n\n  y = y + HKH;\n  x = x + HKW;\n\n  for (float dx = 0.0; dx < KW; dx += 1.0) {\n    for (float dy = 0.0; dy < KH; dy += 1.0) {\n      vec4 v = pickValue_tSrc((y - dy), (x - dx));\n      vec4 m = pickValue_tKernel(dy, dx);\n\n      if (v.r < R && m.r > 0.0) {\n        R = v.r;\n      }\n\n      if (v.g < G && m.g > 0.0) {\n        G = v.g;\n      }\n\n      if (v.b < B && m.b > 0.0) {\n        B = v.b;\n      }\n    }\n  }\n\n\treturn vec4(R, G, B, 1.0);\n}",Re=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[2,2],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(v(2===e.length,"Erosion: Kernel size should be shape of rank 2"),_(n)&&v(e[0]===n.shape[0]&&e[1]===n.shape[1],"Erosion: Structure element has wrong size"),!n){n=new ct("float32",[e[0],e[1],4]);for(var a=0;a<e[0];a+=1)for(var r=0;r<e[1];r+=1)n.set(a,r,0,1),n.set(a,r,1,1),n.set(a,r,2,1),n.set(a,r,3,1)}return new Q("Erosion").Input("tSrc",t.dtype).Input("tKernel","float32").Output(t.dtype).Constant("KW",e[0]).Constant("KH",e[1]).LoadChunk("pickValue").GLSLKernel(Me).Compile({tSrc:t,tKernel:n})},Ve="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nfloat HKW = floor(KW / 2.0);\nfloat HKH = floor(KW / 2.0);\n\nvec4 operation(float y, float x) {\n  float R = 0.0;\n  float G = 0.0;\n  float B = 0.0;\n\n  y = y + HKH;\n  x = x + HKW;\n \n  for (float dx = 0.0; dx < KW; dx += 1.0) {\n    for (float dy = 0.0; dy < KH; dy += 1.0) {\n      vec4 v = pickValue_tSrc((y - dy), (x - dx));\n      vec4 m = pickValue_tKernel(dy, dx);\n\n      if (v.r > R && m.r > 0.0) {\n        R = v.r;\n      }\n\n      if (v.g > G && m.g > 0.0) {\n        G = v.g;\n      }\n\n      if (v.b > B && m.b > 0.0) {\n        B = v.b;\n      }\n    }\n  }\n\n\treturn vec4(R, G, B, 1.0);\n}\n",Le=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[2,2],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(v(2===e.length,"Dilation: Kernel size should be shape of rank 2"),_(n)&&v(e[0]===n.shape[0]&&e[1]===n.shape[1],"Dilation: Structure element has wrong size"),!n){n=new ct("float32",[e[0],e[1],4]);for(var a=0;a<e[0];a+=1)for(var r=0;r<e[1];r+=1)n.set(a,r,0,1),n.set(a,r,1,1),n.set(a,r,2,1),n.set(a,r,3,1)}return new Q("Dilation").Input("tSrc",t.dtype).Input("tKernel","float32").Output(t.dtype).Constant("KW",e[0]).Constant("KH",e[1]).LoadChunk("pickValue").GLSLKernel(Ve).Compile({tSrc:t,tKernel:n})};var Ue=function(t,e,n){v(_(e)||k(e),"".concat(t,": A input is not a Tensor or Operation instance")),v(_(n)||k(n),"".concat(t,": B input is not a Tensor or Operation instance")),v(e.dtype===n.dtype,"".concat(t,": inputs should have the same dtype, got ").concat(e.dtype," and ").concat(n.dtype)),v(e.shape[0]===n.shape[0]&&e.shape[1]===n.shape[1]&&e.shape[3]===n.shape[3],"".concat(t,": inputs should have the same shapes, got ").concat(e.shape," and ").concat(n.shape))},je=function(t,e,n){v("number"==typeof n,"".concat(t,": scalar value is not a number")),v(_(e)||k(e),"".concat(t,": A input is not a Tensor or Operation instance"))},Ke=function(t,e){return Ue("Sub",t,e),new Q("Sub").Input("tA",t).Input("tB",e).Output(t.dtype).LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 A = pickValue_tA(y, x);\n  vec4 B = pickValue_tB(y, x);\n\n\treturn vec4(A.rgb - B.rgb, 1.0);\n}").Compile({tA:t,tB:e})},ze=function(t,e){return Ue("Add",t,e),new Q("Add").Input("tA",t).Input("tB",e).Output(t.dtype).LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 A = pickValue_tA(y, x);\n  vec4 B = pickValue_tB(y, x);\n\n\treturn vec4(A.rgb + B.rgb, 1.0);\n}").Compile({tA:t,tB:e})},Be=function(t,e){return Ue("Div",t,e),new Q("Div").Input("tA",t).Input("tB",e).Output(t.dtype).LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 A = pickValue_tA(y, x);\n  vec4 B = pickValue_tB(y, x);\n\n\treturn vec4(A.rgb / B.rgb, 1.0);\n}").Compile({tA:t,tB:e})},Fe=function(t,e){var n="Mult";return Ue(n,t,e),new Q(n).Input("tA",t).Input("tB",e).Output(t.dtype).LoadChunk("pickValue").GLSLKernel("\n/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 A = pickValue_tA(y, x);\n  vec4 B = pickValue_tB(y, x);\n\n\treturn vec4(A.rgb * B.rgb, 1.0);\n}").Compile({tA:t,tB:e})},Ne=function(t,e){var n="SubScalar";return je(n,t,e),new Q(n).Input("tA",t).Output(t.dtype).Uniform("uScalar","float",e).LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 A = pickValue_tA(y, x);\n\n\treturn vec4(A.rgb - uScalar, 1.0);\n}").Compile({tA:t})},De=function(t,e){var n="AddScalar";return je(n,t,e),new Q(n).Input("tA",t).Output(t.dtype).Uniform("uScalar","float",e).LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 A = pickValue_tA(y, x);\n\n\treturn vec4(A.rgb + uScalar, 1.0);\n}").Compile({tA:t})},Ge=function(t,e){var n="DivScalar";return je(n,t,e),new Q(n).Input("tA",t).Output(t.dtype).Uniform("uScalar","float",e).LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 A = pickValue_tA(y, x);\n\n\treturn vec4(A.rgb / uScalar, 1.0);\n}").Compile({tA:t})},He=function(t,e){var n="MultScalar";return je(n,t,e),new Q(n).Input("tA",t).Output(t.dtype).Uniform("uScalar","float",e).LoadChunk("pickValue").GLSLKernel("/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 A = pickValue_tA(y, x);\n\n\treturn vec4(A.rgb * uScalar, 1.0);\n}").Compile({tA:t})};const We=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"open",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[2,2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];switch(e){case"open":return Le(Re(t,n,a),n,a);case"close":return Re(Le(t,n,a),n,a);case"gradient":return Ke(Le(t,n,a),Re(t,n,a));case"tophat":return Ke(t,Le(Re(t,n,a),n,a));case"blackhat":return Ke(Re(Le(t,n,a),n,a),t);default:return new Error("MorphTransform: unsopported operation type ".concat(e))}},Xe=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",a=~~(t.shape[1]*e),r=~~(t.shape[0]*e);return zt(t,a,r,n)},Ze="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 res = pickValue_tSrc(y, x);\n\n  for (float I = 1.0; I <= SAMPLES_PER_PASS; I += 1.0) {\n    float cx = x - ceil(pow(1.0 + SAMPLES_PER_PASS, PASSI) * I);\n\n    if (cx < 0.0) {\n      break;\n    }\n\n    res += pickValue_tSrc(y, cx);\n  }\n\n  return res;\n}\n",Ye="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 res = pickValue_tSrc(y, x);\n  res = res * res;\n  vec4 v = vec4(0.0);\n\n  for (float I = 1.0; I <= SAMPLES_PER_PASS; I += 1.0) {\n    float cx = x - ceil(pow(1.0 + SAMPLES_PER_PASS, PASSI) * I);\n\n    if (cx < 0.0) {\n      break;\n    }\n\n    v = pickValue_tSrc(y, cx);\n    res += v * v;\n  }\n\n  return res;\n}\n",qe="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nvec4 operation(float y, float x) {\n  vec4 res = pickValue_tSrc(y, x);\n\n  for (float I = 1.0; I <= SAMPLES_PER_PASS; I += 1.0) {\n    float cy = y - ceil(pow(1.0 + SAMPLES_PER_PASS, PASSI) * I);\n\n    if (cy < 0.0) {\n      break;\n    }\n\n    res += pickValue_tSrc(cy, x);\n  }\n\n  return res;\n}\n";var Je=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"x",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return new Q("SummedAreaTable").Input("tSrc",t.dtype).Output("float32").LoadChunk("pickValue").Constant("PASSI",n).Constant("LAST",!1).Constant("SAMPLES_PER_PASS",a).GLSLKernel("x"===e?Ze:qe).Compile({tSrc:t})},Qe=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return new Q("SquaredSummedAreaTable").Input("tSrc",t.dtype).Output("float32").LoadChunk("pickValue").Constant("PASSI",e).Constant("LAST",!1).Constant("SAMPLES_PER_PASS",n).GLSLKernel(Ye).Compile({tSrc:t})},$e=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=Math.ceil(Math.pow(t.shape[1],1/e)),r=Math.ceil(Math.pow(t.shape[0],1/e)),i=t,o=Math.log(t.shape[1])/Math.log(Math.max(a+1,2)),l=Math.log(t.shape[0])/Math.log(Math.max(r+1,2));n&&(i=Qe(i,0,Math.min(a,t.shape[1]-1)));for(var c=n?1:0;c<o;c+=1)i=Je(i,"x",c,Math.min(a,t.shape[1]-1));for(var s=0;s<l;s+=1)i=Je(i,"y",s,Math.min(r,t.shape[0]-1));return i},tn=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return $e(t,e,!1)},en=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return $e(t,e,!0)};const nn="/**\n * @license MIT\n * @author Arkadiy Pilguk(apilguk@gmail.com)\n * @author Mihail Zachepilo(mihailzachepilo@gmail.com)\n * Copyright 2018 Peculiar Ventures and Pentatonica.\n * All rights reserved.\n */\n\nconst int Channel = int(C);\n\nfloat pickValue(float y, float x) {\n\tif (y < 0.0 || x < 0.0) {\n\t\treturn 0.0;\n\t}\n\n\treturn pickValue_tIntegralImage(y, x)[Channel];\n}\n\nvec4 operation(float y, float x) {\n\tvec4 pixel = pickValue_tSrc(y, x);\n\tfloat huS = uS / 2.0;\n\t\n\tvec2 p1 = max(floor(vec2(x, y) - huS), vec2(0.0));\n\tvec2 p2 = min(floor(vec2(x, y) + huS), OUT_VIEW - 1.0);\n\tvec2 pd = p2 + 1.0 - p1;\n\tfloat s = pd.x * pd.y;\n\tp1 -= 1.0;\n\tfloat sum = pickValue(p2.y, p2.x)\n\t\t- pickValue(p1.y, p2.x)\n\t\t- pickValue(p2.y, p1.x)\n\t\t+ pickValue(p1.y, p1.x);\n\n\tif (pixel[Channel] * s <= sum * (100.0 - uT)/ 100.0) {\n\t\treturn vec4(0.0, 0.0, 0.0, 1.0);\t\n\t} else {\n\t\treturn vec4(1.0, 1.0, 1.0, 1.0);\n\t}\n}",an=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:tn(t);return v("number"==typeof n,"Only number available as a threshold value."),v("number"==typeof e,"Only number available as a size value."),v(0===a||1===a||2===a||3===a,"Only RGBA available: 0, 1, 2, 3"),new Q("Threshold").Input("tSrc",t.dtype).Input("tIntegralImage",r.dtype).Output(t.dtype).Constant("C",a).Uniform("uS","float",e).Uniform("uT","float",n).LoadChunk("pickValue").GLSLKernel(nn).Compile({tSrc:t,tIntegralImage:r})};function rn(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function on(t,e,n){return t-1e-7<=e&&e<=n+1e-7}var ln=function(){function t(e,n,a,r,i,o){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e instanceof ArrayBuffer)this.data=new Float32Array(e,n,8);else if(Array.isArray(e)){if(e.length<8)for(var l=e.length;l<=8;l+=1)e.push(0);this.data=new Float32Array(e)}else this.data=void 0!==e&&void 0!==n?new Float32Array([e,n,a,r,i,o,0,0]):new Float32Array(8)}var e,n,a;return e=t,a=[{key:"Intersection",value:function(t,e){var n=t.x1,a=t.y1,r=t.x2,i=t.y2,o=e.x1,l=e.y1,c=e.x2,s=e.y2,u=((n*i-a*r)*(o-c)-(n-r)*(o*s-l*c))/((n-r)*(l-s)-(a-i)*(o-c)),h=((n*i-a*r)*(l-s)-(a-i)*(o*s-l*c))/((n-r)*(l-s)-(a-i)*(o-c));if(isNaN(u)||isNaN(h))return!1;if(n>=r){if(!on(r,u,n))return!1}else if(!on(n,u,r))return!1;if(a>=i){if(!on(i,h,a))return!1}else if(!on(a,h,i))return!1;if(o>=c){if(!on(c,u,o))return!1}else if(!on(o,u,c))return!1;if(l>=s){if(!on(s,h,l))return!1}else if(!on(l,h,s))return!1;return[u,h]}}],(n=[{key:"set",value:function(t,e,n,a,r,i){this.data[0]=t,this.data[1]=e,this.data[2]=n,this.data[3]=a,this.data[4]=r,this.data[5]=i,this.data[6]=0,this.data[7]=0}},{key:"fromParallelCoords",value:function(t,e,n,a,r,i){var o,l,c=n;l=t>i?(i/(t-=i)-1)*n+(o=r-i*e/t):(1-i/(t=i-t))*n+(o=i*e/t),this.set(0,o,c,l,t,e)}},{key:"length",get:function(){if(this.data[6])return this.data[6];var t=this.data[2]-this.data[0],e=this.data[3]-this.data[1],n=Math.sqrt(Math.pow(t,2)+Math.pow(e,2));return this.data[6]=n,n}},{key:"angle",get:function(){if(this.data[7])return this.data[7];var t=this.data[2]-this.data[0],e=this.data[3]-this.data[1],n=Math.atan(e/t)/Math.PI*180;return n<0&&(n=180+n),this.data[7]=n,n}},{key:"x1",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"y1",get:function(){return this.data[1]},set:function(t){this.data[1]=t}},{key:"x2",get:function(){return this.data[2]},set:function(t){this.data[2]=t}},{key:"y2",get:function(){return this.data[3]},set:function(t){this.data[3]=t}},{key:"px",get:function(){return this.data[4]},set:function(t){this.data[4]=t}},{key:"py",get:function(){return this.data[5]},set:function(t){this.data[5]=t}},{key:"clear",value:function(){this.data[0]=0,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=0,this.data[6]=0,this.data[7]=0}},{key:"fromArray",value:function(t){this.data.set(t)}},{key:"toArray",value:function(){return Array.prototype.slice.call(this.data)}}])&&rn(e.prototype,n),a&&rn(e,a),t}();function cn(t,e){var n=t[2]-t[0],a=t[3]-t[1],r=e[2]-e[0],i=e[3]-e[1],o=n*r+a*i,l=(n*n+a*a)*(r*r+i*i);return Math.acos(o/Math.sqrt(l))}function sn(t,e,n){var a,r=n,i=0,o=0,l=0;return i=r.get(0,1)*e+r.get(0,2),o=r.get(1,1)*e+r.get(1,2),l=r.get(2,1)*e+r.get(2,2),i+=r.get(0,0)*t,o+=r.get(1,0)*t,[i*(a=1/(l+=r.get(2,0)*t)),o*a]}function un(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function hn(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}ln.BYTES_PER_ELEMENT=36;var fn=function(){function t(){un(this,t);for(var e=arguments.length,n=new Array(e),a=0;a<e;a++)n[a]=arguments[a];n[0]instanceof ArrayBuffer?this.data=new Float32Array(n[0],n[1],t.NUM_ELEMENTS):Array.isArray(n[0])?this.data=new Float32Array(n[0]):n[0]&&n.length===t.NUM_ELEMENTS?this.data=new Float32Array(n):this.data=new Float32Array(t.NUM_ELEMENTS)}var e,n,a;return e=t,a=[{key:"Distance",value:function(t,e){for(var n=0,a=0;a<8;a+=2){var r=Math.sqrt(Math.pow(t.data[a]-e.data[a],2)+Math.pow(t.data[a+1]-e.data[a+1],2));n+=Math.pow(r,2)}return(n=Math.sqrt(n/8))===1/0?0:n}},{key:"TriangleS",value:function(t,e,n,a,r,i){return Math.abs(t*(a-i)+n*(i-e)+r*(e-a))/2}}],(n=[{key:"isInRect",value:function(e,n){return!(t.TriangleS(e,n,this.ax,this.ay,this.bx,this.by)+t.TriangleS(e,n,this.cx,this.cy,this.bx,this.by)+t.TriangleS(this.cx,this.cy,e,n,this.dx,this.dy)+t.TriangleS(this.dx,this.dy,e,n,this.ax,this.ay)-this.area>0)}},{key:"isNotEmpty",value:function(){return this.data[0]>0&&this.data[1]>0&&this.data[2]>0&&this.data[3]>0&&this.data[4]>0&&this.data[5]>0&&this.data[6]>0&&this.data[7]>0}},{key:"clone",value:function(){return new t(this.toArray())}},{key:"set",value:function(t,e,n,a,r,i,o,l){this.data[0]=t,this.data[1]=e,this.data[2]=n,this.data[3]=a,this.data[4]=r,this.data[5]=i,this.data[6]=o,this.data[7]=l}},{key:"assign",value:function(t){return this.data.set(t.data),this}},{key:"scale",value:function(t,e){return this.data[0]*=t,this.data[1]*=e,this.data[2]*=t,this.data[3]*=e,this.data[4]*=t,this.data[5]*=e,this.data[6]*=t,this.data[7]*=e,this}},{key:"fromLines",value:function(t,e,n,a){var r=function(t,e){var n=[0,0],a=null,r=null,i=null,o=null;n[0]+=t[0][0],n[0]+=t[1][0],n[0]+=t[2][0],n[0]+=t[3][0],n[1]+=t[0][1],n[1]+=t[1][1],n[1]+=t[2][1],n[1]+=t[3][1],n[0]/=4,n[1]/=4;for(var l=0;l<t.length;l+=1)t[l][0]>=n[0]&&t[l][1]>=n[1]&&(i=t[l]),t[l][0]<=n[0]&&t[l][1]<=n[1]&&(a=t[l]),t[l][0]>=n[0]&&t[l][1]<=n[1]&&(r=t[l]),t[l][0]<=n[0]&&t[l][1]>=n[1]&&(o=t[l]);return[a,r,i,o]}([ln.Intersection(t,e),ln.Intersection(e,n),ln.Intersection(n,a),ln.Intersection(a,t)]);return!!(r[0]&&r[1]&&r[2]&&r[3])&&(this.data[0]=r[0][0],this.data[1]=r[0][1],this.data[2]=r[1][0],this.data[3]=r[1][1],this.data[4]=r[2][0],this.data[5]=r[2][1],this.data[6]=r[3][0],this.data[7]=r[3][1],!0)}},{key:"ax",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"ay",get:function(){return this.data[1]},set:function(t){this.data[1]=t}},{key:"bx",get:function(){return this.data[2]},set:function(t){this.data[2]=t}},{key:"by",get:function(){return this.data[3]},set:function(t){this.data[3]=t}},{key:"cx",get:function(){return this.data[4]},set:function(t){this.data[4]=t}},{key:"cy",get:function(){return this.data[5]},set:function(t){this.data[5]=t}},{key:"dx",get:function(){return this.data[6]},set:function(t){this.data[6]=t}},{key:"dy",get:function(){return this.data[7]},set:function(t){this.data[7]=t}},{key:"distA",get:function(){return Math.sqrt(Math.pow(this.data[6]-this.data[0],2)+Math.pow(this.data[7]-this.data[1],2))}},{key:"distB",get:function(){return Math.sqrt(Math.pow(this.data[4]-this.data[2],2)+Math.pow(this.data[5]-this.data[3],2))}},{key:"distC",get:function(){return Math.sqrt(Math.pow(this.data[0]-this.data[2],2)+Math.pow(this.data[1]-this.data[3],2))}},{key:"distD",get:function(){return Math.sqrt(Math.pow(this.data[6]-this.data[4],2)+Math.pow(this.data[7]-this.data[5],2))}},{key:"distE",get:function(){return Math.sqrt(Math.pow(this.data[0]-this.data[4],2)+Math.pow(this.data[1]-this.data[5],2))}},{key:"distF",get:function(){return Math.sqrt(Math.pow(this.data[6]-this.data[2],2)+Math.pow(this.data[7]-this.data[3],2))}},{key:"angleA",get:function(){return cn([this.data[6],this.data[7],this.data[0],this.data[1]],[this.data[0],this.data[1],this.data[2],this.data[3]])}},{key:"angleB",get:function(){return cn([this.data[0],this.data[1],this.data[2],this.data[3]],[this.data[2],this.data[3],this.data[4],this.data[5]])}},{key:"angleC",get:function(){return cn([this.data[2],this.data[3],this.data[4],this.data[5]],[this.data[4],this.data[5],this.data[6],this.data[7]])}},{key:"angleD",get:function(){return cn([this.data[4],this.data[5],this.data[6],this.data[7]],[this.data[6],this.data[7],this.data[0],this.data[1]])}},{key:"area",get:function(){var t=this.distA,e=this.distB,n=this.distC,a=this.distD,r=(t+e+n+a)/2;return Math.sqrt((r-t)*(r-e)*(r-n)*(r-a))}},{key:"P",get:function(){return this.distA+this.distB+this.distC+this.distD}},{key:"mul",value:function(t){return this.data[0]*=t,this.data[1]*=t,this.data[2]*=t,this.data[3]*=t,this.data[4]*=t,this.data[5]*=t,this.data[6]*=t,this.data[7]*=t,this}},{key:"scaleAt",value:function(t){return this.data[0]-=t,this.data[1]-=t,this.data[2]-=t,this.data[3]+=t,this.data[4]+=t,this.data[5]+=t,this.data[6]+=t,this.data[7]-=t,this}},{key:"clear",value:function(){this.data[0]=0,this.data[1]=0,this.data[2]=0,this.data[3]=0,this.data[4]=0,this.data[5]=0,this.data[6]=0,this.data[7]=0}},{key:"fromDeep",value:function(t){return this.data[0]=t[0][0],this.data[1]=t[0][1],this.data[2]=t[1][0],this.data[3]=t[1][1],this.data[4]=t[2][0],this.data[5]=t[2][1],this.data[6]=t[3][0],this.data[7]=t[3][1],this}},{key:"perspective",value:function(t){var e=sn(this.data[0],this.data[1],t),n=sn(this.data[2],this.data[3],t),a=sn(this.data[4],this.data[5],t),r=sn(this.data[6],this.data[7],t);return this.data[0]=e[0],this.data[1]=e[1],this.data[2]=n[0],this.data[3]=n[1],this.data[4]=a[0],this.data[5]=a[1],this.data[6]=r[0],this.data[7]=r[1],this}},{key:"fromArray",value:function(t){return this.data.set(t),this}},{key:"toArray",value:function(){return Array.prototype.slice.call(this.data)}},{key:"isInside",value:function(t){return t.ax>this.ax&&t.ay>this.ay&&t.bx<this.bx&&t.by>this.by&&t.cx<this.cx&&t.cy<this.cy&&t.dx>this.dx&&t.dy<this.dy}},{key:"toJSON",value:function(){return this.toArray()}}])&&hn(e.prototype,n),a&&hn(e,a),t}();fn.NUM_ELEMENTS=8,fn.BYTES_PER_ELEMENT=fn.NUM_ELEMENTS*Float32Array.BYTES_PER_ELEMENT},2249:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var a=n(3645),r=n.n(a)()((function(t){return t[1]}));r.push([t.id,'.padding_2bziG{padding-bottom:calc(108.5% + 20px)}.controls_wrapper_2ruB-{position:absolute;top:0;left:0;width:100%;z-index:5;height:100%;border-radius:8px;border:1px solid #f1f3f8}.header_2ZCIT{padding:20px;border-bottom:1px solid #f1f3f8}.title_3UGy2{width:calc(100% - 60px);display:inline-block;vertical-align:top}.reset_BgWH7{cursor:pointer;transition:opacity .3s;display:inline-block;vertical-align:top}.reset_BgWH7:hover{opacity:.6}.groups_2Jroi{padding:20px;height:calc(100% - 69px);overflow:auto;-webkit-overflow-scrolling:touch}.group_name_1vgOu{margin-bottom:21px}.group_17ujR{margin-bottom:36px;border-bottom:1px solid #f1f3f8}.group_item_2LLsc{text-align:left;margin-bottom:14px}.group_item_2LLsc:before{display:inline-block;height:100%;vertical-align:middle;content:""}.group_item_name_lMrNc{width:98px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:inline-block;vertical-align:middle;margin-right:20px}.group_item_value_3wKKY{width:40px;margin-left:15px;display:inline-block;vertical-align:middle}.tabs_2USS2{display:inline-block;vertical-align:middle;width:calc(100% - 160px)}.slider_dKhuf{width:calc(100% - 205px);display:inline-block;vertical-align:middle}.icon_3J74F{margin-right:10px;width:22px;display:inline-block;vertical-align:middle}.m_disabled_3rL2k{pointer-events:none;opacity:.5}@media(max-width: 768px),(max-width: 812px)and (max-height: 375px){.padding_2bziG{padding-bottom:calc(100vh - 60px)}.controls_wrapper_2ruB-{border-radius:0;border:none}.header_2ZCIT{padding:15px 30px;border-bottom:1px solid rgba(245,246,249,.19)}.groups_2Jroi{height:calc(100% - 59px);padding:30px}.title_3UGy2{color:#f4f5f9 !important}.group_17ujR{border-bottom:none}.group_name_1vgOu{margin-bottom:16px}.group_item_name_lMrNc{color:#f4f5f9 !important}.group_item_value_3wKKY{color:#f4f5f9 !important}}',""]),r.locals={padding:"padding_2bziG",controls_wrapper:"controls_wrapper_2ruB-",header:"header_2ZCIT",title:"title_3UGy2",reset:"reset_BgWH7",groups:"groups_2Jroi",group_name:"group_name_1vgOu",group:"group_17ujR",group_item:"group_item_2LLsc",group_item_name:"group_item_name_lMrNc",group_item_value:"group_item_value_3wKKY",tabs:"tabs_2USS2",slider:"slider_dKhuf",icon:"icon_3J74F",m_disabled:"m_disabled_3rL2k"};const i=r},3955:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var a=n(3645),r=n.n(a)()((function(t){return t[1]}));r.push([t.id,".wrapper_2cyJ6{width:100%;min-width:400px}.padding_37s3V{border:1px solid #f1f3f8;border-radius:8px;padding-bottom:76.8%;position:relative}.canvas_1lLYV{position:absolute;top:0;left:0;z-index:2;border-radius:8px;width:100%;height:100%}.mask_3vmwV{opacity:0;cursor:pointer;transition:opacity .3s;position:absolute;top:0;left:0;width:100%;height:100%;z-index:3;border-radius:8px}.controls_x_cwp{pointer-events:none;opacity:0;transition:opacity .3s;position:absolute;top:50%;left:50%;width:100px;height:100px;transform:translate(-50%, -50%);z-index:5}.icon_wLiG1{width:100%}.loader_3JRlk{position:absolute;z-index:3;top:50%;width:40px;height:40px;left:50%;transform:translate(-50%, -50%)}@media(max-width: 768px),(max-width: 812px)and (max-height: 375px){.wrapper_2cyJ6{min-width:0}.padding_37s3V{border:none;border-radius:0;padding-bottom:calc(100vh - 60px)}.mask_3vmwV{border-radius:0}.canvas_1lLYV{border-radius:0}}",""]),r.locals={wrapper:"wrapper_2cyJ6",padding:"padding_37s3V",canvas:"canvas_1lLYV",mask:"mask_3vmwV",controls:"controls_x_cwp",icon:"icon_wLiG1",loader:"loader_3JRlk"};const i=r},5970:(t,e,n)=>{"use strict";n.d(e,{Z:()=>i});var a=n(3645),r=n.n(a)()((function(t){return t[1]}));r.push([t.id,'.example_wrapper_Qhzw2{height:100%;padding:40px 70px;text-align:center}.example_wrapper_Qhzw2:before{display:inline-block;vertical-align:middle;height:100%;content:""}.container_7rs6E{height:100%;max-height:615px;width:100%;display:inline-block;vertical-align:middle;max-width:1200px}.fps_2BOOk{opacity:0;display:inline-block;transition:opacity .3s}.part_2WQL3{position:relative;width:100%;display:inline-block;vertical-align:top;margin-right:20px}.part_2WQL3:last-child{margin-right:0}.title_2UB96{margin-bottom:42px}.title_text_1BT0C{margin-right:30px}.none_3wVv2{display:none}.close_block_2LM9u{padding:30px 30px 0 0;z-index:4;position:absolute;bottom:30px;left:30px}.icon_1FK36{display:inline-block;vertical-align:top;margin-right:10px;height:15px}.sett_text_1o-bP{line-height:.8 !important;vertical-align:top;display:inline-block}.mask_1f0BV{position:absolute;top:0;left:0;width:100%;height:100%;opacity:.7;z-index:4;background-color:#fff}@media(max-width: 768px),(max-width: 812px)and (max-height: 375px){.example_wrapper_Qhzw2{padding:0;padding-top:60px;overflow:hidden}.container_7rs6E{position:relative;max-height:100%}.title_2UB96{position:absolute;top:20px;left:25px;z-index:4;color:#f4f5f9 !important;max-width:calc(100% - 50px)}.part_2WQL3{width:100%;height:100%}.part_2WQL3:last-child{position:absolute;top:0;left:0;width:100%;height:100%;z-index:3}}.error_container_3gCjg{display:inline-block;max-width:430px;padding:0 30px;text-align:center;vertical-align:middle}.error_icon_dg7ga{display:inline-block;margin-bottom:55px;width:85px}.button_K367K{width:190px;padding:0 10px !important;margin-top:55px}',""]),r.locals={example_wrapper:"example_wrapper_Qhzw2",container:"container_7rs6E",fps:"fps_2BOOk",part:"part_2WQL3",title:"title_2UB96",title_text:"title_text_1BT0C",none:"none_3wVv2",close_block:"close_block_2LM9u",icon:"icon_1FK36",sett_text:"sett_text_1o-bP",mask:"mask_1f0BV",error_container:"error_container_3gCjg",error_icon:"error_icon_dg7ga",button:"button_K367K"};const i=r},169:function(t){t.exports=function(){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if("function"!=typeof e)throw new Error("Callback is not a function");if("number"!=typeof n||isNaN(n)||n<0||n===1/0)throw new Error("refreshRate should be a positive number! e.g. 2 (fps)");var a=-1,r=0,i=void 0,o=0,l=0,c="object"===("undefined"==typeof performance?"undefined":t(performance))&&"now"in performance?performance.now.bind(performance):Date.now.bind(Date);return function(){if(a>=r){var t=c();void 0===i&&(i=t);var s=t-i;if(s>0){var u=a>0?1e3/(s/a):0;l=Math.abs(o-u),n>0?(r=.5*r+u/n*.5)<0&&(r=0):r=0;var h={fps:u,jitter:l,elapsed:s,frames:a,trigger:r};i=t,o=u,a=0,e(h)}else r*=2}a++}}}()},5242:t=>{"use strict";t.exports=JSON.parse('[{"key":"morphology","name":"MORPHOLOGY","examples":[{"type":"video","name":"Erosion","path":"erode"},{"type":"video","name":"Dilation","path":"dilate"},{"type":"video","name":"Extended Morphology","path":"morphology_ex"}]},{"key":"processing","name":"PROCESSING","examples":[{"type":"video","name":"Gaussian Blur","path":"gaussian_blur"},{"type":"video","name":"Convolution","path":"conv2d"},{"type":"video","name":"Downsample","path":"downsample"},{"type":"video","name":"Upsample","path":"upsample"},{"type":"video","name":"Resize","path":"resize"},{"type":"video","name":"Color Segmentation","path":"color_segmentation"},{"type":"video","name":"Normalization","path":"norm"},{"type":"video","name":"Histogram Equalization","path":"histogram_equalization"},{"type":"video","name":"HSV Color Converter","path":"hsv_color"},{"type":"video","name":"Threshold","path":"threshold"},{"type":"video","name":"Adaptive Threshold","path":"adaptive_threshold"},{"type":"video","name":"Summed Area Table","path":"sat"}]},{"key":"feature_extraction","name":"Feature extraction","examples":[{"type":"video","name":"Hog","path":"hog"},{"type":"video","name":"Canny Edges","path":"canny_edges"},{"type":"video","name":"Skin Test","path":"skin_test"},{"type":"video","name":"PCLinest","path":"pc_lines"},{"type":"video","name":"Extract Mean and Std","path":"extract_mean_std"},{"type":"video","name":"Extract Histogram","path":"histogram"}]},{"key":"image_derivatives","name":"Image Derivatives","examples":[{"type":"video","name":"Sobel Operator","path":"sobel_operator"}]},{"key":"math","name":"Math","examples":[{"type":"video","name":"Tensor Scalar","path":"math_tensor_scalar"},{"type":"video","name":"Pixelwise Math","path":"math_pixelwise"}]}]')},8251:(t,e,n)=>{var a={"./adaptive_threshold.js":[5508,5508],"./canny_edges.js":[4957,4957],"./color_segmentation.js":[9811,9811],"./conv2d.js":[9279,9279],"./dilate.js":[7852,7852],"./downsample.js":[4891,4891],"./erode.js":[8409,8409],"./extract_mean_std.js":[4062,4062],"./gaussian_blur.js":[3221,3221],"./histogram.js":[9583,9583],"./histogram_equalization.js":[7934,7934],"./hog.js":[1116,1116],"./hsv_color.js":[5777,5777],"./math_pixelwise.js":[5252,5252],"./math_tensor_scalar.js":[3232,3232],"./morphology_ex.js":[2409,2409],"./motion_detect.js":[6418,6418],"./norm.js":[5221,5221],"./pc_lines.js":[2301,2301],"./resize.js":[7959,7959],"./sat.js":[1910,1910],"./skin_test.js":[6546,6546],"./sobel_operator.js":[4949,4949],"./threshold.js":[6388,6388],"./upsample.js":[4734,4734]};function r(t){if(!n.o(a,t))return Promise.resolve().then((()=>{var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}));var e=a[t],r=e[0];return n.e(e[1]).then((()=>n(r)))}r.keys=()=>Object.keys(a),r.id=8251,t.exports=r}}]);